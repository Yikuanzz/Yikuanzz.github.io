<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>
        <meta name='description' content='概述 OSI 参考模型 网络通信是一个庞大的工程，其中网络协议就采用分层设计的思想。国际化标准组织提出了 开放式系统互联模型（open system interconnection model），'><title>计算机网络学习</title>

<link rel='canonical' href='https://yikuanzz.github.io/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/'>

<link rel="stylesheet" href="/scss/style.min.46208cabd58e8bcef0cfb7d7ea6b561adcca3b91dd1fc6657493a44f03c5db75.css"><meta property='og:title' content='计算机网络学习'>
<meta property='og:description' content='概述 OSI 参考模型 网络通信是一个庞大的工程，其中网络协议就采用分层设计的思想。国际化标准组织提出了 开放式系统互联模型（open system interconnection model），'>
<meta property='og:url' content='https://yikuanzz.github.io/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/'>
<meta property='og:site_name' content='Yikuanzz'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='计算机网络' /><meta property='article:published_time' content='2024-05-21T08:10:37&#43;08:00'/><meta property='article:modified_time' content='2024-05-21T08:10:37&#43;08:00'/><meta property='og:image' content='https://yikuanzz.github.io/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/cover.png' />
<meta name="twitter:title" content="计算机网络学习">
<meta name="twitter:description" content="概述 OSI 参考模型 网络通信是一个庞大的工程，其中网络协议就采用分层设计的思想。国际化标准组织提出了 开放式系统互联模型（open system interconnection model），"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://yikuanzz.github.io/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/cover.png' />
    <link rel="shortcut icon" href="https://s2.loli.net/2024/03/22/Z5UYhgiHmGofML8.jpg" />

  

<style>
    :root {
        --article-font-family: "Noto Serif SC", var(--base-font-family);
    }
</style>

<script> 
		(function () {
		    const customFont = document.createElement('link');
		    customFont.href = "https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;700&display=swap"; 
		    customFont.type = "text/css";
		    customFont.rel = "stylesheet";
		
		    document.head.appendChild(customFont);
		}());
</script>

    </head>
    <body class="
    article-page
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    <!-- 
        extended
     -->
    on-phone--column extended
">
    
<div id="article-toolbar">
    <a href="https://yikuanzz.github.io/" class="back-home">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



        <span>Back</span>
    </a>
</div>
    <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/aa2_hue12ee8e79b9cb68bf5d1297bba3d9824_12551_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🎧</span>
                
            </figure>
            
        
        
        <h1 class="site-name"><a href="/">Yikuanzz</a></h1>
        <h2 class="site-description">Anytimes you like.</h2><ol class="social-menu">
                
                    <li>
                        <a 
                            href='https://space.bilibili.com/15264235'
                            target="_blank"
                            title="Bilibili"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-bilibili" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#87CEFA" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" />
  <path d="M8 3l2 3" />
  <path d="M16 3l-2 3" />
  <path d="M9 13v-2" />
  <path d="M15 11v2" />
</svg>
                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://github.com/Yikuanzz'
                            target="_blank"
                            title="GitHub"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ff9300" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://leetcode.cn/u/yikuanzz/'
                            target="_blank"
                            title="Leetcode"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-leetcode" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ff2825" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 13h7.5" />
  <path d="M9.424 7.268l4.999 -4.999" />
  <path d="M16.633 16.644l-2.402 2.415a3.189 3.189 0 0 1 -4.524 0l-3.77 -3.787a3.223 3.223 0 0 1 0 -4.544l3.77 -3.787a3.189 3.189 0 0 1 4.524 0l2.302 2.313" />
</svg>
                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://www.zhihu.com/people/dolikes'
                            target="_blank"
                            title="Zhihu"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-zhihu" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#009988" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M14 6h6v12h-2l-2 2l-1 -2h-1z" />
  <path d="M4 12h6.5" />
  <path d="M10.5 6h-5" />
  <path d="M6 4c-.5 2.5 -1.5 3.5 -2.5 4.5" />
  <path d="M8 6v7c0 4.5 -2 5.5 -4 7" />
  <path d="M11 18l-3 -5" />
</svg>
                            
                        </a>
                    </li>
                
            </ol></header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>首页</span>
            </a>
        </li>
        
        

        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/">
                <img src="/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/cover_hu7de092c981d04a68ecb78876337b6c3c_1423095_800x0_resize_box_3.png"
                        srcset="/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/cover_hu7de092c981d04a68ecb78876337b6c3c_1423095_800x0_resize_box_3.png 800w, /2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/cover_hu7de092c981d04a68ecb78876337b6c3c_1423095_1600x0_resize_box_3.png 1600w"
                        width="800" 
                        height="420" 
                        loading="lazy"
                        alt="Featured image of post 计算机网络学习" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E6%8A%80%E6%9C%AF%E4%B8%8E%E6%95%88%E7%8E%87/" style="background-color: #FF8C00; color: #fff;">
                技术与效率
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/2024/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/">计算机网络学习</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 21, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-words">
                    12580字
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    
    
    <h2 id="概述">概述</h2>
<h3 id="osi-参考模型">OSI 参考模型</h3>
<p>网络通信是一个庞大的工程，其中网络协议就采用分层设计的思想。国际化标准组织提出了 开放式系统互联模型（open system interconnection model），简称 OSI 模型。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521081401.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521081401.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>物理层（physical layer），负责管理通信设备和通信媒介，对设备的针脚、电压、线缆等做了详尽的定义。物理层为我们屏蔽了物理设备的底层细节，为上层提供信息比特传输能力。至于它对于线缆、电压等的规定，软件研发人员一般不需要关注。</p>
<p>数据链路层（data link layer）以 帧（frame）为传输单元，负责网络寻址、错误侦测，可以解决同一网络内多台主机的通信问题，最终实现局域网通信。</p>
<p>网络层（network layer）以 数据包（packet）为传输单元，负责路径选择和数据包转发。网络层建立在数据链路层的基础上，它实现了全网通信能力，可以将数据传送到网络中任一的节点。数据链路层只实现了局域网内的通信能力，为网络层提供服务，将包送至下一节点。两者分工明确，彼此协作。</p>
<p>传输层（transport layer）在网络层基础上，为应用进程提供端到端的通信服务，支持面向连接的数据流、流量控制以及可靠性保障。一个节点上通常有许多应用进程，为此传输层引入了端口的概念，实现了从进程到进程的传输能力。在 段（segment）中包含端口信息，网络转发后目标节点在包中取出段，再根据端口号送至目标进程。</p>
<p>应用层（application layer）负责应用的通信逻辑，并提供多样的网络应用服务。</p>
<ul>
<li>会话层（session layer）为通信实体实现会话和连接管理功能，主要提供 用户认证、权限控制 等服务。</li>
<li>表示层（presentation layer）为不同终端的用户提供一致的数据表示和变换方法，比如 数据的编解码、数据的加密压缩、数据的压缩解压 等等。</li>
</ul>
<h3 id="tcpip-协议栈">TCP/IP 协议栈</h3>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521083842.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521083842.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>网络访问层（network access layer）负责管理物理介质，并提供将数据从当前节点传输到下一节点的能力，相当于 物理层 + 数据链路层。</p>
<ul>
<li>不同的通信介质，有不同的接入设备，采用的协议也不同：Ethernet，以太网协议；PPP，点对点协议；DSL，用户数字线路 等等。</li>
</ul>
<p>网络互连层（internet layer）在网络访问层提供的局域网通信能力之上，实现网际通信能力，负责路径选择和数据包转发，相当于 网络层。</p>
<ul>
<li>IP 协议在该层以 IP 包为通信单元，通过该协议通信的主机需要分配一个 IP 地址，包中用 IP 地址来标识包的来源和目的地。</li>
</ul>
<p>传输层（transport layer）在网络互连层点到点传输能力基础上，实现端到端的进程间通信。</p>
<ul>
<li>UDP 协议引入了一个端口号，当 UDP 段搭载在 IP 包中送给主机后，系统根据段中的数据提交给对应的进程。</li>
<li>TCP 协议相对 UDP协议 来说，它为进程提供可靠、有序的数据流。</li>
</ul>
<p>应用层（application layer）定义具体网络应用的通信逻辑，让应用进程间的写作成为可能。</p>
<ul>
<li>网络应用协议常见的有：HTTP、HTTPS、FTP、SMTP 等等。</li>
</ul>
<h2 id="ethernet以太网协议">Ethernet：以太网协议</h2>
<h3 id="物理层数据链路层">物理层+数据链路层</h3>
<p>物理层的任务主要是确定与传输媒体接口的一些特性：</p>
<ul>
<li>（1）机械特性：指明接口接线器的形状和尺寸、引脚数目和排列、固定和锁定壮志等。</li>
<li>（2）电气特性：指明接口电缆的各线上出现的电压的范围。</li>
<li>（3）功能特性：指明某条线上出现的某一电平的电压的意义。</li>
<li>（4）过程特性：指明对于不同功能的各种可能事件的出现顺序。</li>
</ul>
<hr>
<p>对于数据链路，我们先知道链路是指一段物理线路，中间没有任何交换节点；数据链路则是说，我们在这条物理线路上还需要一些通信协议来控制数据的传输。</p>
<p>一般通过网络适配器来实现这些协议，它通常包括了数据链路和物理层的功能。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604024024.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604024024.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="以太网帧结构">以太网帧结构</h3>
<p>在以太网中，数据通信达基本单位是 以太网帧（frame），由 头部（header）、数据（data）以及 校验和（checksum）三部分构成。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521091248.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521091248.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>以太网帧头部包含 3 个字段：</p>
<ul>
<li>目的地址，长度为 6 个字节，用于标记数据由哪台机器接收。</li>
<li>源地址，长度为 6 个字节，用于标记数据由哪台机器发送。</li>
<li>类型，长度为 2 字节，用于标记数据如何处理，<code>0x0800</code> 表示该帧数据是一个 IP 包。</li>
</ul>
<p>以太网数据是任何需要发送的信息，长度可变，46 至 1500 字节均可。</p>
<p>以太网校验和，长度为 4 个字节。因为物理信号可能受到环境干扰，网络设备传输的比特流会出错，为了保证传输以太网帧的时候是完好无损的，我们就要用到校验和。</p>
<ul>
<li>发送者负责为每个以太网帧计算校验和，并计算结果填写在校验和字段中；接收者接收到以太网帧后，重新计算校验和并与校验和字段对比；如果两个校验和不一致，说明该帧在传输时出错了。</li>
</ul>
<h3 id="mac-地址">MAC 地址</h3>
<p>MAC（Media Access Control Address）地址也是以太网地址，也叫硬件地址、物理地址、网卡地址。</p>
<ul>
<li>物理层上，网卡负责比特流和电信号之间相互转换。</li>
<li>软件层上，内核协议栈负责封装以太网帧，并调用网卡驱动发送；接收数据时，负责验证 目的地址、校验和 并取出数据部分交予上层协议栈处理。</li>
</ul>
<p>MAC 地址由 6 个字节（48位）组成。</p>
<ul>
<li>3 字节长的 厂商代码（OUI），由国际组织分配给不同的网络设备商。</li>
<li>3 字节长的 序列号（SN），由厂商分配给它生产的网络设备。</li>
</ul>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521093723.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521093723.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>MAC 地址很难直接用 ASCII 码来解读，所以我们将一个 8 位 字节的字符，分成 高 4 位 和 低 4 位，并且每个部分用 16 进制的字符来表示。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521094526.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240521094526.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>在 Linux 系统中，我们用 <code>ip link</code> 命令来查看网卡。</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#56b6c2">[</span>root@iZ7xvfomazz4187zib4aurZ ~<span style="color:#56b6c2">]</span><span style="color:#7f848e"># ip link</span>
</span></span><span style="display:flex;"><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#d19a66">65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span style="color:#d19a66">1000</span>
</span></span><span style="display:flex;"><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style="display:flex;"><span>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#d19a66">1500</span> qdisc pfifo_fast state UP mode DEFAULT group default qlen <span style="color:#d19a66">1000</span>
</span></span><span style="display:flex;"><span>    link/ether 00:16:3e:03:2c:8d brd ff:ff:ff:ff:ff:ff
</span></span><span style="display:flex;"><span>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span style="color:#d19a66">1500</span> qdisc noqueue state DOWN mode DEFAULT group default 
</span></span><span style="display:flex;"><span>    link/ether 02:42:61:8f:61:b8 brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><p>我们也可以通过套接字编程直接向系统获取，Linux 套接字支持通过 <code>ioctl</code> 系统调用获取网络设备，大致步骤如下：（补充内容请看附录）</p>
<p>​	1、创建套接字。</p>
<p>​	2、准备 <code>ifreq</code> 结构体，保存网卡设备信息。</p>
<p>​	3、将查询网卡名填充到 <code>ifreq</code>。</p>
<p>​	4、调用 <code>ioctl</code> 系统，向套接字发送 <code>SIOCGIFHWADDR</code>请求获取物理地址。</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;net/if.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;stdio.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;string.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;sys/ioctl.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;sys/socket.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">void</span> <span style="color:#61afef;font-weight:bold">mac_ntoa</span>(<span style="color:#e5c07b">unsigned</span> <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">n</span>, <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">a</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// 格式化数据，并写入字符串 a
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#61afef;font-weight:bold">sprintf</span>(<span style="color:#e06c75">a</span>, <span style="color:#98c379">&#34;%02x:%02x:%02x:%02x:%02x:%02x&#34;</span>, <span style="color:#e06c75">n</span>[<span style="color:#d19a66">0</span>], <span style="color:#e06c75">n</span>[<span style="color:#d19a66">1</span>], <span style="color:#e06c75">n</span>[<span style="color:#d19a66">2</span>], <span style="color:#e06c75">n</span>[<span style="color:#d19a66">3</span>], <span style="color:#e06c75">n</span>[<span style="color:#d19a66">4</span>], <span style="color:#e06c75">n</span>[<span style="color:#d19a66">5</span>]);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">argc</span>, <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">argv</span>[]){
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#e06c75">argc</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">2</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#61afef;font-weight:bold">fprintf</span>(<span style="color:#e06c75">stderr</span>, <span style="color:#98c379">&#34;no iface given</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">return</span> <span style="color:#d19a66">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// 创建套接字
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#e5c07b">int</span> <span style="color:#e06c75">s</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">socket</span>(<span style="color:#e06c75">AF_INET</span>, <span style="color:#e06c75">SOCK_STREAM</span>, <span style="color:#d19a66">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span> <span style="color:#56b6c2">==</span> <span style="color:#e06c75">s</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#61afef;font-weight:bold">perror</span>(<span style="color:#98c379">&#34;Fail to create socket&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">return</span> <span style="color:#d19a66">2</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// 填充字符串名字
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#c678dd">struct</span> <span style="color:#e06c75">ifreq</span> <span style="color:#e06c75">ifr</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">strncpy</span>(<span style="color:#e06c75">ifr</span>.<span style="color:#e06c75">ifr_name</span>, <span style="color:#e06c75">argv</span>[<span style="color:#d19a66">1</span>], <span style="color:#d19a66">15</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  	<span style="color:#7f848e">// 调用 ioctl 驱动获得地址
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#e5c07b">int</span> <span style="color:#e06c75">ret</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">ioctl</span>(<span style="color:#e06c75">s</span>, <span style="color:#e06c75">SIOCGIFHWADDR</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">ifr</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span> <span style="color:#56b6c2">==</span> <span style="color:#e06c75">ret</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#61afef;font-weight:bold">perror</span>(<span style="color:#98c379">&#34;Fail to get mac address&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">return</span> <span style="color:#d19a66">3</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// 转换为可读形式
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#e5c07b">char</span> <span style="color:#e06c75">mac</span>[<span style="color:#d19a66">18</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">mac_ntoa</span>((<span style="color:#e5c07b">unsigned</span> <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span>)<span style="color:#e06c75">ifr</span>.<span style="color:#e06c75">ifr_hwaddr</span>.<span style="color:#e06c75">sa_data</span>, <span style="color:#e06c75">mac</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// 输出结果
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;IFace: %s</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#e06c75">ifr</span>.<span style="color:#e06c75">ifr_name</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;MAC: %s</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#e06c75">mac</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#d19a66">0</span>;       
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="mtu-最大传输单元">MTU 最大传输单元</h3>
<p>如果待发送的数据超过帧的最大承载能力，就需要先对数据进行分片，然后再通过若干个帧进行传输。</p>
<p>待发送的数据总共 4000 字节，假设以太网设备一帧最多只能承载 1500 字节。很明显，数据需要划分成 3 片，再通过 3 个帧进行发送。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240523105425.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240523105425.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="编程发送以太网帧">编程发送以太网帧</h3>
<p>实现 sendether 命令，用于发送以太网帧，它的用法是：</p>
<ul>
<li>-i -iface：用于发送以太网帧的网卡名。</li>
<li>-t -to：目的 MAC 地址。</li>
<li>-T -type：以太类型。</li>
<li>-d -data：待发送数据。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>send_ether -i enp0s8 -t 0a:00:27:00:00:00 -T 0x1024 -d <span style="color:#98c379">&#34;Hello, world!&#34;</span>
</span></span></code></pre></div><p>使用 <code>enp0s8</code> 网卡，向 <code>0a:00:27:00:00:00</code> 发送一个类型为 <code>0x1024</code> 的以太网帧。</p>
<h2 id="ip互联网协议">IP：互联网协议</h2>
<h3 id="网络层">网络层</h3>
<p>在数据链路层中，我们能够实现同一网络内多台主机之间的通信问题，网络适配器将数据封装为以太网帧然后发送给其他主机。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604024257.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604024257.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>为了能够实现更大规模的网络互联，我们在数据链路层的基础上添加了网络层。</p>
<p>网络层做了什么呢？</p>
<p>它给参与网络层通信的主机都分配一个唯一地址，并且这些地址是按照网络拓扑结构进行分配的，保证一个组织内部的地址是连续的。</p>
<p>然后，它将多个不同的以太网用转发设备进行互联，这个转发设备维护路由表，规定了目的地址和下一条都对应关系。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604024957.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604024957.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="ip-包结构">IP 包结构</h3>
<p><em>IP</em> 是 <strong>互联网协议</strong> ( <em>internet protocol</em> ) 的简称，是 <em>TCP/IP</em> 协议栈中的网络层协议。<em>IP</em> 协议在发展的过程中，衍生出 <em>IPv4</em> 和 <em>IPv6</em> 两个不同版本。其中，历史版本 <em>IPv4</em> 目前仍广泛使用；后继版本 <em>IPv6</em> 世界各地正在积极部署。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604025327.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604025327.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="ip-地址详解">IP 地址详解</h3>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604042556.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604042556.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>主机号比特全为 0 ，是网络的起始地址，用于表示网络本身，一般称为 <strong>网络地址</strong> ；</li>
<li>主机号比特全为 1 ，是网络的结束地址，用于向网络内的所有主机进行广播，一般称为 <strong>广播地址</strong> ；</li>
</ul>
<h3 id="子网掩码">子网掩码</h3>
<p>我们可以通过子网长度来划定子网个数，一般使用掩码来记录 IP 地址中的网络号部分。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604043015.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604043015.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>掩码位数与 IP 地址一样，<code>1</code> 表示该位属于网络号，<code>0</code> 表示该位属于主机号。如果你学过 C 语言，应该知道通过按位与操作 <code>&amp;</code> ，掩码可以快速取出一个 IP 地址的网络号。</p>
<p>这就是所谓的 <strong>子网掩码</strong> ，它也可以用 <strong>点分十进制表示法</strong> 来表示，用来描述 IP 地址的网络号部分。因此，子网 <code>10.0.0.x</code> 可以表示成 <code>10.0.0.0/255.255.255.0</code> ；A 类网络 <code>10.x.x.x</code>可以表示成 <code>10.0.0.0/255.0.0.0</code> 。</p>
<p>实际上，描述网络号还有更简洁的方法：在 IP 地址后面加上斜杆和网络号的位数。例如：</p>
<ul>
<li><code>10.0.0.0/255.255.255.0</code> 可以表示成 <code>10.0.0.0/24</code> ；</li>
<li><code>10.0.0.0/255.0.0.0</code> 可以表示成 <code>10.0.0.0/8</code> ；</li>
</ul>
<h3 id="ttlip-包存活时间">TTL，IP 包存活时间</h3>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604043223.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604043223.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><strong>环</strong> （ <em>cycle</em> ），一种首尾相连的特殊路径，是图论中重点研究的对象。如果 IP 包陷入环路的包无法清理，最终将耗尽线路的带宽和路由器的处理资源，影响正常数据的传输，造成大量丢包。</p>
<p>IP 包中的 TTL 字段是 Time To Live 的缩写，表示 IP 包的存活时间，如果 IP 包存活时间超过 TTL，路由就会将它丢弃。这样就算 IP 包陷入循环，经过一小段时间，它也会从网络中消失，不会造成更大的影响。</p>
<p>但因为网络路由器数量巨大，很难做到时间同步，因此，在实际工程实现中，TTL 并不是直接保存存活时间，而是保存 IP 包失效前可以经过的路由跳数。IP 包每经过一跳路由，TTL 都会减一；当 TTL 减到 0 ，路由便将它丢弃。</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#56b6c2">[</span>root@yikuanzz ~<span style="color:#56b6c2">]</span><span style="color:#7f848e"># cat /proc/sys/net/ipv4/ip_default_ttl</span>
</span></span><span style="display:flex;"><span><span style="color:#d19a66">64</span>
</span></span></code></pre></div><h3 id="网络规划">网络规划</h3>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604051038.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604051038.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>假设，公司现在要给每个部分组建一个局域网，每个局域网通过一台路由器接到核心路由网络。</p>
<p>我们还注意到，不同的部门，主机数量也有多有少：</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">部门</th>
<th style="text-align:left">主机数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">行政部</td>
<td style="text-align:left">50</td>
</tr>
<tr>
<td style="text-align:left">研发部</td>
<td style="text-align:left">100</td>
</tr>
<tr>
<td style="text-align:left">市场部</td>
<td style="text-align:left">80</td>
</tr>
<tr>
<td style="text-align:left">人力部</td>
<td style="text-align:left">50</td>
</tr>
<tr>
<td style="text-align:left">法务部</td>
<td style="text-align:left">50</td>
</tr>
</tbody>
</table></div>
<p>因此，每个部门局域网所需要的网段，大小也是不一样的。假设管理员拿到了一个地址段 <code>192.168.170.0/23</code> ，如何将地址划分给图中的子网呢？</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604051254.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604051254.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604051323.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604051323.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>按照上述划分，我们就可以将各个部门的子网都分配好了。</p>
<h2 id="arp地址解析协议">ARP：地址解析协议</h2>
<h3 id="arp-协议原理">ARP 协议原理</h3>
<p>我们知道，可以通过 IP 地址来指定数据包发送的目标地址，但是在数据链路层封装为帧的时候，怎么知道目标 IP 的 MAC 地址呢？</p>
<p>最直觉的方法就是让主机发送广播，询问网络中的其他主机来去得到目标 IP 的 MAC 地址。</p>
<p><em>ff:ff:ff:ff:ff:ff</em> 是一个特殊的广播地址，目的地址为 <em>ff:ff:ff:ff:ff:ff</em> 的以太网帧，将被送到以太网中的每一台主机。交换机收到目的地址为 <em>ff:ff:ff:ff:ff:ff</em> 的帧后，也会将它广播到所有端口。</p>
<p>当主机收到目标 IP 发给自己的 MAC 地之后将其放在映射表中，后面传输的时候就可以直接从缓存中查询了。当然，为了保证时效性，ARP 缓存是要设置有效期到，如果缓存失效了，系统就必须重新发起 ARP 查询并且缓存最新结果。</p>
<p>那么，ARP 协议就是对这个过程进行统一的规范，并且 ARP 报文是内嵌在以太网帧之中的。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604074618.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604074618.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>一个 <em>ARP</em> 报文中有 <em>9</em> 个字段，分别是：</p>
<ul>
<li><strong>硬件类型</strong>（ <em>hardware type</em> ），数据链路层协议类型，例如： <code>1</code> 表示以太网协议；</li>
<li><strong>协议类型</strong>（ <em>protocol type</em> ），网络层协议类型，例如 <code>0x0800</code> 表示 <em>IP</em> 协议；</li>
<li><strong>硬件地址长度</strong>（ <em>hardware address length</em> ），数据链路层地址长度，对以太网来说，地址长度为 <em>6</em> 字节；</li>
<li><strong>协议地址长度</strong>（ <em>protocol addess length</em> ），网络层地址长度，对 <em>IP</em> 协议来说，地址长度为 <em>4</em> 字节；</li>
<li><strong>操作码</strong>（ <em>operation</em> ），报文的操作类型，<code>1</code> 表示 <strong>请求</strong> （ <em>request</em> ），<code>2</code> 表示 <strong>应答</strong> （ <em>reply</em> ）；</li>
<li><strong>源硬件地址</strong>（<em>sender hardware address</em>），即发送者的数据链路层地址；
<ul>
<li>对于 <em>ARP</em> 请求，该字段表示请求发起者的地址；</li>
<li>对于 <em>ARP</em> 应答，该字段表示请求应答者的地址，也就是发起者查找的地址；</li>
</ul>
</li>
<li><strong>源协议地址</strong>（ <em>sender protocol address</em> ），即发送者的网络层地址；</li>
<li><strong>目标硬件地址</strong>（<em>target hardware address</em>），即接收者的数据链路层地址；
<ul>
<li>对于 <em>ARP</em> 请求，这个字段被忽略；</li>
<li>对于 <em>ARP</em> 应答，这个字段表示请求发起者的地址；</li>
</ul>
</li>
<li><strong>目标协议地址</strong>（ <em>target protocol address</em>），即接收者的网络层地址；
<ul>
<li>对于 <em>ARP</em> 请求，这个字段就是待查找地址；</li>
<li>对于 <em>ARP</em> 应答，这个字段表示请求发起者的地址；</li>
</ul>
</li>
</ul>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604075137.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604075137.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604075451.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604075451.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><a class="link" href="https://datatracker.ietf.org/doc/html/rfc826"  target="_blank" rel="noopener"
    >拓展阅读：RFC828</a></p>
<h3 id="arp-攻击">ARP 攻击</h3>
<p>因为 ARP 协议没有真伪校验机制，如果黑客进入到主机所在的网络，他就可以轻易地监听主机发送的网络信息。</p>
<p>在 ARP 广播的时候，黑客不断地发送伪造的 ARP 回应给主机， 当然黑客为了保持隐蔽，它还是会将包转发给网关。这样，主机以为自己将包发送给了网关，而网关也误以为自己收到了主机发送的数据。</p>
<p>那么，怎么防止 ARP 攻击呢？</p>
<ul>
<li>
<p><strong>双绑措施</strong></p>
<p>在路由和终端上同时进行 IP 地址和 MAC 地址的绑定，相当于人工管理 ARP 缓存，自行维护 IP 地址和 MAC 地址的对应关系。既然将 ARP 协议弃之不用，黑客就无法发起攻击了。</p>
<p>这个方案虽然可以奏效，但维护非常繁琐。换个网卡或 IP 地址，都需要重新修改配置。当流动电脑临时接入时，也要即时进行绑定，费时费力。</p>
</li>
<li>
<p><strong>交换机端口绑定</strong></p>
<p>跟双绑措施类似，只不过将 IP 和交换机端口进行绑定，缺点也是类似的。</p>
</li>
<li>
<p><strong>PPPoE</strong></p>
<p>使用 PPPoE 协议对网络流量进行二次封装，为每个用户都分配账号密码，上网时必须通过认证。这样 ARP 报文在一个认证的通道中传输，也就不会遭受攻击了。</p>
<p>但 PPPoE 也不是完美的，由于二次封装的存在，传输效率会打些折扣。更严重的是，PPPoE 方式下局域网内无法互访。如果局域网内需要部署文件服务器、打印机，就有麻烦了。</p>
</li>
</ul>
<p>其实最关键的一点在于，坚持使用 HTTPS 这样的加密协议。这样就算遭遇 ARP 劫持，信息也不会被窃取。在陌生的网络环境中，应该尽量不用 HTTP 这样的明文协议。</p>
<h2 id="icmp互联网控制报文协议">ICMP：互联网控制报文协议</h2>
<h3 id="icmp-协议概述">ICMP 协议概述</h3>
<p><strong>互联网控制消息协议</strong> ( <em>Internet Control Message Protocol</em> )简称 <em>ICMP</em> ，是 <em>IP</em> 的辅助协议，同样位于网络层，负责网际通信中 <strong>控制信息</strong> 和 <strong>差错信息</strong> 的传送。</p>
<p><em>ICMP</em> 有赖 <em>IP</em> 提供的网际通信能力，它的报文作为数据承载在 <em>IP</em> 包中进行传输。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604081554.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604081554.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><em>ICMP</em> 报文同样分为 <strong>头部</strong> 和 <strong>数据</strong> 两部分，其中头部字段如下：</p>
<ul>
<li><strong>类型</strong> （ <em>type</em> ），顾名思义用来标识 <em>ICMP</em> 报文的类型，例如 <strong>目的不可达</strong> （ <em>destination unreachable</em> ）差错报文；</li>
<li><strong>代码</strong> （ <em>code</em> ），进一步划分 <em>ICMP</em> 报文的类型，标识错误的原因，例如目的不可达可以进一步分成网络不可达、主机不可达以及端口不可达等等；</li>
<li><strong>校验和</strong> （ <em>checksum</em> ），用于差错校验，由 <em>ICMP</em> 头部计算得出；</li>
</ul>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604082236.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604082236.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><a class="link" href="https://datatracker.ietf.org/doc/html/rfc792"  target="_blank" rel="noopener"
    >拓展阅读：RFC 792</a></p>
<h2 id="udp用户数据报协议">UDP：用户数据报协议</h2>
<h3 id="传输层概述">传输层概述</h3>
<p>在网络层中，我们实现点对点之间的数据传输，就是将数据封装为 IP 包，在包头指定目标主机的 IP 地址，然后在数据链路层封装为以太网帧，发送给路由器，再由路由器进行分发。</p>
<p>当然，一台主机上不可能指挥允许一个进程，点到点之间的数据传输并不能满足我们的需求，也就是说，我们需要进程与进程之间的传输。</p>
<p>于是在上述基础上，我们添加了传输层，引入了端口（port）的概念，用来区分不同的通信端点。</p>
<p>一台主机上可以有很多个通信端口，应用进程可以关联到一个或多个端口。当进程需要发送数据时，它必须申请一个端口，数据从该端口发送出去；当某个端口有数据到达时，操作系统负责将数据提交给对应的应用进程。</p>
<p>这种从进程到进程的传输能力，可以叫做端到端的传输。</p>
<p>我们有一些知名的端口号：</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">服务</th>
<th style="text-align:left">端口</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">FTP文件传输</td>
<td style="text-align:left">20 、 21</td>
</tr>
<tr>
<td style="text-align:left">SSH安全远程登录</td>
<td style="text-align:left">22</td>
</tr>
<tr>
<td style="text-align:left">SMTP邮件传输</td>
<td style="text-align:left">25</td>
</tr>
<tr>
<td style="text-align:left">DNS域名系统</td>
<td style="text-align:left">53</td>
</tr>
<tr>
<td style="text-align:left">Web</td>
<td style="text-align:left">80 、 443</td>
</tr>
</tbody>
</table></div>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604084608.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604084608.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="udp-数据报格式">UDP 数据报格式</h3>
<p>UDP 是 <strong>用户数据包协议</strong> （ <em>user datagram protocol</em> ）的简称，它是一种简单的数据报式传输层协议。UDP 数据报结构非常简单，头部只包含端口号等若干个字段。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604085348.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604085348.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>由于 UDP 位于传输层，因而报文有时也称为 UDP 段或 UDP 分组。UDP 报文也分为头部和数据两个部分，结构跟我们在上节讨论的传输层段几乎一模一样。其中，头部只有 4 个字段：</p>
<ul>
<li><strong>源端口</strong>（ <em>source port</em> ），发送方的端口号；</li>
<li><strong>目的端口</strong>（ <em>destination port</em> ），接收方的端口号；</li>
<li><strong>报文长度</strong>（ <em>length</em> ），即整个 UDP 报文的长度，包括头部和数据，单位为 <strong>字节</strong> 。</li>
<li><strong>检验和</strong>（ <em>checksum</em> ），与 IP 校验不同，UDP 整个报文都会参与校验和计算，除此之外，UDP 还会在报文前面拼接一个 IP 伪头部，同时参与校验和计算；</li>
</ul>
<p>UDP 报文需要借助 IP 协议提供的主机通信能力，作为数据搭载在 IP 包中发往目标主机。</p>
<p><a class="link" href="https://datatracker.ietf.org/doc/html/rfc768"  target="_blank" rel="noopener"
    >拓展阅读：RFC 768</a></p>
<h2 id="tcp传输控制协议">TCP：传输控制协议</h2>
<h3 id="tcp-协议简介">TCP 协议简介</h3>
<p>UDP 数据报是借助 IP 包提供的点对点传输能力来实现的端到端的传输，然而 IP 协议只是一种“尽力而为”的网络协议，它无法保证 IP 包一定能够送到目标主机。实际上，由于网路链路拥堵或者中间路由设备故障点存在，会有 IP 丢包的现象出现。此外，UDP 协议也没有流量控制机制、也没有拥塞控制机制，当遇到某些情况时是无法解决的。</p>
<p>为了解决 UDP 协议的局限性，一种更高级的传输协议被设计出来了 TCP（<em>Transimission Control Protocol</em>）它是一种 <strong>面向连接的流式协议</strong> ，可为应用程序提供 <strong>可靠的字节流传输服务</strong> 。</p>
<ol>
<li>连接主动发起方（一般是客户端），向被动连接方（一般是服务端）发出 <code>SYN</code> ；</li>
<li>被动连接方收到 <code>SYN</code> 后，向主动发起方回复 <code>SYN+ACK</code> ；</li>
<li>主动发起方收到 <code>SYN</code> 后，向被动连接方回复 <code>ACK</code> ；</li>
</ol>
<p>其中，<code>SYN</code> 指令表示序号同步请求，<code>ACK</code> 表示确认，即对同步请求进行确认。</p>
<p>TCP 将数据组织成连续的字节流，每个字节均可由一个唯一的序号来标识。</p>
<p>TCP 在发送数据时，会将数据的 起始序号 和 长度 告诉对端，接收方收到数据后，将发送 ACK 对数据进行确认。ACK 中包含确认序号，它的值为最后一个已接收字节的序号加一，也就是接收方期望收到的新数据的起始序号。</p>
<p>那么，TCP 如何实现 流量控制 和 拥塞控制 的呢？</p>
<ul>
<li>
<p>流量控制。根据 TCP 协议规定，接收方需要维护一个 <strong>接收窗口</strong> ，我们可以将它看作内存中的一个缓冲区。在连接建立和数据传输的过程中，接收方会将自己的接收窗口大小通告给发送方。发送方必须保证，发送的数据不超过接收窗口。如果接收窗口被占满，发送方就暂停发送新数据。</p>
</li>
<li>
<p>拥塞控制。TCP 发送方自己在内部维护了一个 <strong>发送窗口</strong> ，也叫做 <strong>拥塞窗口</strong> 。这是一个为发送策略算法服务的虚拟概念，表示可以发送的字节数（包含已经发送但仍未确认部分）。发送窗口一开始呈指数增长，比如每收到一个 ACK 就将它翻倍；当接收窗口增大到一定水平，增长速度降为线性增长。这就是 TCP 的 <strong>慢启动</strong> 过程，在网络状况良好的前提下，不断提高发送速度。如果网络发生拥塞，有数据丢包，这时 TCP 必须重传数据。发送方在重传数据的同时，还会降低发送窗口大小。这种情况下，大部分 TCP 实现会将发送窗口降为原来的一半，以便快速响应，避免进一步堵塞网络。这个机制也被称为 <strong>指数退避</strong> 。</p>
</li>
</ul>
<p>最后是 TCP 的关闭，假设主机①数据发送完毕，它向主机②发出 FIN ，成为主动关闭方；主机②则成为被动关闭方，它回复 ACK 后，从主机①到主机②的数据流关闭。这时，连接处于 <strong>半关闭状态</strong> ，反方向的数据流仍然有效。也就是说，这时主机②还可以向主机①发送数据。当主机②也发完数据，它同样发出 FIN 指令，告诉主机①数据流关闭；主机①收到 FIN 并回复 ACK 后，连接就完全关闭了。这就是 TCP 连接关闭的主要步骤，也被形象地称为“四次挥手”。</p>
<h3 id="tcp-报文段格式">TCP 报文段格式</h3>
<p>由于 TCP 协议位于传输层，它的传输单元一般叫做 <strong>TCP段</strong>（ <em>segment</em> ），也可译为 <strong>TCP分组</strong> 。当然了，也有不少文献将它笼统地称为 <strong>TCP报文</strong> 。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604092255.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604092255.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="三次握手">三次握手</h3>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604090908.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240604090908.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605133204.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605133204.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>MSS 选项。最大分组长度（<em>maximum segment size</em>）就表示一个 TCP 分组最多能够承载的数据量。</li>
<li>窗口扩大因子。如果窗口字段表示的范围太小了，我们可用窗口字段大小与穿过扩大因子相乘，该相乘是指将数据左移。</li>
</ul>
<p><a class="link" href="https://datatracker.ietf.org/doc/html/rfc793"  target="_blank" rel="noopener"
    >拓展阅读：RFC793</a></p>
<h3 id="四次挥手">四次挥手</h3>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605133927.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605133927.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>一个 TCP 连接包含两个方向的传输通道，因此需要两对 FIN/ACK 分组，各自负责关闭对应的方向。因此，这两对 FIN/ACK 交互也被形象地称为 <strong>四次挥手</strong> 。</p>
<p>TCP 建立连接需要三次握手，关闭连接需要四次挥手，步骤相对繁琐。这意味着一个 TCP 连接应该有很多中间状态。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605134254.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605134254.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<ol>
<li>客户端发出 SYN 分组，连接进入 SYN_SENT 状态；</li>
<li>服务端收到客户端发来的 SYN 分组，它回复 SYN/ACK 分组，连接进入 SYN_RECV 状态；</li>
<li>客户端收到服务器的 SYN/ACK 分组，它回复 ACK 分组，连接进入 ESTABLISHED 状态；</li>
<li>服务器收到客户端的 ACK 分组，服务端连接也进入 ESTABLISHED 状态；</li>
<li>当连接处于 ESTABLISHED 状态时，客户端和服务端可以互相传输数据；</li>
<li>时序图中间的数据分组及其后的 ACK 分组，为实验中 SSH 服务向客户机返回自己的版本信息（这部分数据被 telnet 命令直接输出到屏幕中）；</li>
<li>客户端准备退出时，它通过 FIN 分组通知服务端，连接进入 FIN_WAIT1 状态；</li>
<li>服务器收到客户端发来的 FIN 分组，它回复 ACK 分组进行确认，连接进入 CLOSE_WAIT 状态；</li>
<li>客户端收到服务器发来的 ACK 分组，连接进入 FIN_WAIT2 状态；</li>
<li>这时连接处于半关闭状态，服务器仍可以向客户端发送数据；</li>
<li>服务器发完剩余数据后，向客户端发送 FIN 分组，通知客户端关闭连接，服务端连接便进入 LAST_ACK 状态；</li>
<li>客户端收到服务器发来的 FIN 分组，回复 ACK 分组进行确认，客户端连接进行 TIME_WAIT 状态；</li>
<li>服务端收到 ACK 分组后，连接彻底关闭；</li>
<li>由于最后一个 ACK 分组可能会丢，客户端必须在 TIME_WAIT 状态等待一段时间，以便对服务器重传的 FIN 分组进行确认；</li>
</ol>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605134411.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605134411.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>其中，可以再看一下的是 TIME_WAIT 状态中的 2MSL时长，MSL 是最大分组寿命（ <em>maximum segment lifetime</em> ）的简称，即一个 TCP 分组被丢弃前能够在网络中存在的最长时间。</p>
<p>将 TIME_WAIT 状态维持 2MSL 时长是出于这样的考虑：</p>
<p>假设最后一个 ACK 分组刚好在存活时间耗尽前到达对端主机，这时已经过了 MSL 时间。对端收到 ACK 后，就会立即关闭连接，不可能再发送 FIN 分组。但如果对端在收到 ACK 前刚刚重传了 FIN 分组，就必须再经过 MSL 时间才能保证 FIN 分组从网络中消失。因此，连接必须维持 TIME_WAIT 状态 2MSL 时间后才能释放，否则就可能对潜在的新连接造成干扰。</p>
<ul>
<li>如果最后一个 ACK 分组可以到达对端，最多只需要等待 2MSL 时间即可保证网络中没有对端重传的 FIN 分组；</li>
<li>如果最后一个 ACK 分组丢失了，对端在 MSL 内已经重传好多次了；
<ul>
<li>如果重传的 FIN 分组有一个可以到达本端，TCP 回复 ACK 后会重置定时器在 TIME_WAIT 继续等待 2MSL 时长；</li>
<li>如果重传的 FIN 分组都丢了，说明网络质量很差，再等下去也没有意义了；</li>
</ul>
</li>
</ul>
<p>主动关闭方一般是客户端，并发一般不高，因此 TIME_WAIT 状态基本不会造成任何影响。如果一个高并发服务（比如 Web 服务）存在大量短连接，则可能留下很多 TIME_WAIT 状态的连接。由于 TIME_WAIT 状态套接字无法立即回收，它们将占用大量的系统资源，对服务的性能造成严重影响。</p>
<h3 id="滑动窗口tcp的流量控制">滑动窗口，TCP的流量控制</h3>
<ul>
<li>
<p><em>TCP</em> 协议规定：当接收方收到一个数据后，必须回复 <em>ACK</em> 给发送方。这样发送方就能得到反馈，如果数据发出去后很长时间都没有收到 <em>ACK</em> 确认，说明数据很有可能已经丢失了。<em>TCP</em> 每次发送数据后，都会启动一个定时器。如果定时器超时还没收到对方确认，<em>TCP</em> 就会重新发送数据。</p>
</li>
<li>
<p>由于承载 <em>TCP</em> 报文段的 <em>IP</em> 包是独立路由的，可能走不同的网络路径，无法保证一定按照发送顺序送达目标主机。 <em>TCP</em> 协议需要向上提供连续字节流传输服务，如果报文段错序到达，<em>TCP</em> 必须根据序号重新排列数据。另一方面，数据到达后目标主机后，接收方应用程序可能忙于其他事情，无法及时处理。鉴于这两个点，<em>TCP</em> 接收方需要在内存中准备一个接收缓冲区，用于临时保存数据。</p>
</li>
</ul>
<p>接收缓冲区大小是有限的，如果应用进程处理缓慢，发送方还拼命发送，最终肯定会压垮接收方。因此，当缓冲区有变化时，接收方应该通过 <strong>窗口大小</strong> 字段，将它的剩余大小告知发送方。</p>
<p>接收方通告的窗口大小通常称为 <strong>通告窗口</strong>（ <em>advertised window</em> ），可缩写为 <em>awnd</em> 。它起到约束发送方发送速度的作用：</p>
<ul>
<li>如果接收方应用进程繁忙，迟迟未读取缓冲区里的数据，那么窗口大小将慢慢变小；</li>
<li>当窗口大小降为零，发送方就停止发送新数据；</li>
</ul>
<p>通过通告窗口，发送方可以实时感知接收方缓冲区的状态，然后根据缓冲区剩余空间动态调整发送速度，这就是 <em>TCP</em> 的 <strong>流量控制</strong>（ <em>flow control</em> ）机制。</p>
<p>从数据发送方来说，数据状态的变化就是用滑动窗口来实现的。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605140427.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605140427.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605140453.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605140453.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><em>TCP</em> 协议规定，接收方收到数据后，必须发送 <em>ACK</em> 进行确认，以此实现可靠传输。然而，就算是一个小小的 <em>ACK</em> 确认，也需要一个完整 <em>TCP</em> 分组报文来承载，开销很大！</p>
<p>众所周知，最小的 <em>TCP</em> 分组包含 <em>20</em> 字节的 <em>TCP</em> 头部和 <em>20</em> 字节的 <em>IP</em> 头部，总共 <em>40</em> 字节。试想发送一个 <em>40</em> 字节的 <em>TCP</em> 报文，仅仅只为了告诉发送方 <em>4</em> 字节的确认号，效率得有多低！有效信息才占 <em>10%</em> ！</p>
<p>为了提高传输效率，<em>TCP</em> 实现了 <strong>延迟确认</strong>（ <em>delayed ACK</em> ）机制。延迟确认顾名思义就是收到数据不立马确认，而是等上一段时间，跟其他数据一起发送。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605140644.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605140644.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="拥塞窗口tcp的拥塞控制">拥塞窗口，TCP的拥塞控制</h3>
<p>为实现可靠传输，<em>TCP</em> 实现了接收确认机制：当数据发生丢包时，重传数据。当网络链路负载很重，甚至发生拥塞时，丢包就会很频繁。这时如果 <em>TCP</em> 还拼命地重传数据，将进一步压垮网络！</p>
<p>网络拥塞（<em>network congestion</em>）是说，每条网络线路都是有带宽的，如果网络流量超超过带宽，丢包就是不可避免的。</p>
<ul>
<li>维护拥塞窗口，限制数据发送量；</li>
<li>根据网络当前状态，实时调节拥塞窗口：
<ul>
<li>如果长时间未收到 <em>ACK</em> 而发生数据重传，说明网络可能拥塞，缩小拥塞窗口，降低发送速度；</li>
<li>每收到一个有效 <em>ACK</em> 都增大拥塞窗口，提高发送速度，因为这通常意味着网络状态良好；</li>
</ul>
</li>
</ul>
<p><em>TCP</em> 还维护了 <strong>拥塞窗口</strong>（ <em>congestion window</em> ），根据链路的拥塞程度来约束发送速度。</p>
<p>拥塞窗口跟滑动窗口类似，同样规定了发送方此刻能够发送出去的字节数，只不过它通过评估网络链路的拥塞程度，并由一定的算法计算而来的。
$$
W = min(awnd, cwnd)
$$
其中，awnd 为通知窗口大小，cwnd 为拥塞窗口大小。</p>
<p><em>TCP</em> 学习 <em>cwnd</em> 的算法可以总结为：慢启动、拥塞避免、快速重传和快速恢复。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143011.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143011.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143229.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143229.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143317.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143317.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>收到重复的确认，说明发出去的数据发生丢包，意味着网络可能发生拥塞。<em>TCP</em> 同样会将 <em>ssthresh</em> 设为当前拥塞窗口 <em>cwnd</em> 的一半，并重新执行慢启动算法加以应对。</p>
<p>快速重传算法会受到捎带确认机制的制约。试想接收方刚好没有数据要发，因此 <em>ACK</em> 确认被延迟，乃至合并，发送方就不会检测到重复确认。</p>
<p>为了解决这个矛盾，<em>TCP</em> 规定接收方接到乱序数据后就立马发送 <em>ACK</em> 确认。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143709.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143709.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>新版 <em>TCP</em>（ <em>Reno</em> ）选择跳过慢启动，直接进入拥塞避免阶段，这就是所谓的 <strong>快速恢复</strong>。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143738.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143738.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>将 <em>ssthresh</em> 设为当前窗口的一半；</li>
<li>将当前窗口设为 <em>ssthresh</em> ；</li>
<li>执行拥塞避免，窗口大小线性扩张；</li>
</ul>
<p>实际上，在 <em>TCP</em> 检测到网络拥塞时，窗口和 <em>ssthresh</em> 都是立马减半，因而被称为 <strong>乘法减小</strong> 或者 <strong>指数退避</strong> 。每次降低一半，这种下降速度其实也是很快的。</p>
<h2 id="dns域名系统">DNS：域名系统</h2>
<h3 id="域名系统的概述">域名系统的概述</h3>
<p>域名是 <strong>网域名称</strong> （ <em>domain name</em> ）的简称，它是一串以点号分隔的字符串，用于标识一台或一组计算机。域名可作为 IP 地址的别名，更便于记忆。</p>
<p>实际上，域名是一个分层次的命名空间，各种域名都隶属于根域 <code>.</code> 。位于第一层的域名称为 <strong>一级域名</strong> 或 <strong>顶级域名</strong> ；第二层的域名称为 <strong>二级域名</strong> ；以此类推。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143950.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605143950.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>以 <code>www.fasionchan.com.</code>为例，从右往左读依次是：</p>
<ul>
<li>根</li>
<li>一级域名（顶级域名）：<code>com</code></li>
<li>二级域名：<code>fasionchan</code></li>
<li>三级域名：<code>www</code></li>
</ul>
<p>域名注册后，所有人拥有域名的管理权：不仅可以修改域名关联的 IP ，还可以分配子域名。域名 <code>fasionchan.com</code> 被注册后，可以修改它关联的 IP ，还可以随意添加子域名 <code>www.fasionchan.com</code> 。</p>
<p>域名的第一级是 <strong>顶级域</strong> ，包括</p>
<ul>
<li><strong>通用顶级域</strong> ，例如 <code>.com</code> 、 <code>.net</code> 和 <code>.org</code> 等；</li>
<li><strong>国家和地区顶级域</strong> ，例如 <code>.cn</code> 、 <code>.us</code> 等；</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">通用顶级域</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">.com</td>
<td style="text-align:left">商业公司</td>
</tr>
<tr>
<td style="text-align:left">.edu</td>
<td style="text-align:left">教育机构</td>
</tr>
<tr>
<td style="text-align:left">.net</td>
<td style="text-align:left">互联网服务供应商</td>
</tr>
<tr>
<td style="text-align:left">.org</td>
<td style="text-align:left">非营利组织、国际机构等</td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">国家和地区顶级域</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">.cn</td>
<td style="text-align:left">中国</td>
</tr>
<tr>
<td style="text-align:left">.hk</td>
<td style="text-align:left">中国香港</td>
</tr>
<tr>
<td style="text-align:left">.mo</td>
<td style="text-align:left">中国澳门</td>
</tr>
<tr>
<td style="text-align:left">.tw</td>
<td style="text-align:left">中国台湾</td>
</tr>
<tr>
<td style="text-align:left">.jp</td>
<td style="text-align:left">日本</td>
</tr>
<tr>
<td style="text-align:left">.us</td>
<td style="text-align:left">美国</td>
</tr>
</tbody>
</table></div>
<p><strong>域名系统</strong> （ <em>domain name system</em> ，简称 DNS ），是互联网提供的一项名字服务。我们可以将 DNS 看作一个分布式数据库，它保存着域名和 IP 的映射关系。</p>
<p>有了这个对应关系，我们就可以通过 <strong>域名</strong> （ <em>domain name</em> ）来访问网络服务，不用再苦苦记忆 IP 地址。要知道域名 <code>www.fasionchan.com</code> 比 IP 地址 <code>163.181.33.224</code> 好记多了。</p>
<p>域名注册后，所有人可将域名关联的 IP 登记到域名系统。这是一个分布式数据库，以域名为键，以 IP 为值。域名系统提供一些服务器用户查询，这就是 <strong>DNS服务器</strong>（ <em>dns server</em> ）。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605144349.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605144349.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="dns服务器工作原理">DNS服务器工作原理</h3>
<p>全球域名的最高管理机构是 ICANN （ <em>Internet Corporation for Assigned Names and Numbers</em> ），它是一个总部位于美国加州的组织。ICANN 负责管理整个域名系统的运作，主要工作是规划 <strong>顶级域名</strong> （ <em>top level domain</em> ，简写为 <em>TLD</em> ）。</p>
<p>顶级域名是域名的第一级，可分为两种：</p>
<ul>
<li><strong>通用顶级域</strong> ，例如 <code>.com</code> 、 <code>.net</code> 、 <code>.edu</code> 、 <code>.org</code> 等等；</li>
<li><strong>国家地区顶级域</strong> ，例如 <code>.cn</code> 、 <code>.hk</code> 、<code>.jp</code> 、 <code>.us</code> 等等；</li>
</ul>
<p>理论上，查询任何域名都需要先查询 ICANN 的根域。因为只有根域才能知道：某个域由谁托管，服务器是哪些。事实上也确实如此，ICANN 维护着一张映射表，记录了每个顶级域名和对应的托管商。</p>
<p><strong>根域名服务器</strong> （ <em>root name server</em> ）保存 DNS 的根区列表。</p>
<p>根域名服务器列表可在 <a class="link" href="https://root-servers.org/"  target="_blank" rel="noopener"
    >root-servers.org</a> 上查询。 <em>Anycast</em> 路由技术：分散在不同地理位置的多台服务器，可以使用相同的 IP 地址。当发送方向这个 IP 地址发送数据时，路由协议会自动选择一个最近的节点。</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#56b6c2">[</span>root@yikuanzz ~<span style="color:#56b6c2">]</span><span style="color:#7f848e"># dig . NS</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>; &lt;&lt;&gt;&gt; DiG 9.11.4-P2-RedHat-9.11.4-26.P2.el7_9.15 &lt;&lt;&gt;&gt; . NS
</span></span><span style="display:flex;"><span>;; global options: +cmd
</span></span><span style="display:flex;"><span>;; Got answer:
</span></span><span style="display:flex;"><span>;; -&gt;&gt;HEADER<span style="color:#98c379">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span style="color:#d19a66">24903</span>
</span></span><span style="display:flex;"><span>;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: <span style="color:#d19a66">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;; QUESTION SECTION:
</span></span><span style="display:flex;"><span>;.				IN	NS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;; ANSWER SECTION:
</span></span><span style="display:flex;"><span>.			7	IN	NS	j.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	g.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	c.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	h.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	e.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	l.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	m.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	d.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	b.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	a.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	i.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	f.root-servers.net.
</span></span><span style="display:flex;"><span>.			7	IN	NS	k.root-servers.net.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;; Query time: <span style="color:#d19a66">0</span> msec
</span></span><span style="display:flex;"><span>;; SERVER: 100.100.2.136#53<span style="color:#56b6c2">(</span>100.100.2.136<span style="color:#56b6c2">)</span>
</span></span><span style="display:flex;"><span>;; WHEN: Wed Jun <span style="color:#d19a66">05</span> 14:48:29 CST <span style="color:#d19a66">2024</span>
</span></span><span style="display:flex;"><span>;; MSG SIZE  rcvd: <span style="color:#d19a66">433</span>
</span></span></code></pre></div><p>当我们查询一个域名时，必须从根服务器开始，逐层查询，这就是所谓的 <strong>迭代查询</strong> （ <em>iterative query</em> ）。</p>
<p>当我们查询一个域名，例如 <code>www.fasionchan.com</code> 时：</p>
<ol>
<li>先查根域名服务器；
<ul>
<li>根域名服务器就 <em>13</em> 台，<em>IP</em> 大家都知道，极少改动；</li>
<li>根域名服务器保存根区列表，列表包含顶级域名的托管商，以及相关服务器信息；</li>
<li>根域名服务器根据根区列表，告诉我们 <code>.com</code> 顶级域应该找谁查询；</li>
</ul>
</li>
<li>根据根服务器返回结果，继续查询负责 <code>.com</code> 解析的服务器，一般叫做顶级域名服务器；
<ul>
<li>主域名 <code>fasionchan.com</code> 注册后，需要将负责该域名解析的服务器，登记在 <code>.com</code> 顶级域名服务器上；</li>
<li><code>.com</code> 顶级域名服务器根据这个信息，告诉我们 <code>fasionchan.com</code> 这个域名应该找谁查询；</li>
</ul>
</li>
<li>根据顶级域名服务器返回结果，继续查询负责<code>fasionchan.com</code>解析的服务器，一般叫做权威域名服务器；
<ul>
<li><code>fasionchan.com</code> 子域信息一般都登记在权威服务器上；</li>
<li>权威服务器取出 <code>www.fasionchan.com</code> 对应记录，并返回给我们，查询结束；</li>
<li>如果某个子域由其他权威服务器负责，我们还需要继续迭代，直到查询完毕；</li>
</ul>
</li>
</ol>
<p>一般来说，本地主机会通过本地的 递归解析器 去对网址进行递归，递归解析对客户端来说是完全透明的，客户端完全不用关心递归解析器背后的其他 DNS 服务器。</p>
<p>此外，递归解析器还会将查询结果在本地缓存起来。当域名再次被查询时，它可直接返回缓存结果，无须重新查询其他 DNS 服务器。正因如此，递归解析器通常被称为 <strong>DNS缓存服务器</strong> 。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605173540.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605173540.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="dns-报文格式">DNS 报文格式</h3>
<p>DNS 是一个典型的 Client-Server 应用，客户端发起域名查询请求，服务端对请求进行应答。</p>
<p>DNS 一般采用 UDP 作为传输层协议（TCP也行），端口号是 53。请求报文和应答报文均作为数据，搭载在 UDP 数据报中进行传输。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605174015.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605174015.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>DNS 报文分为 <strong>请求</strong> 和 <strong>应答</strong> 两种，结构是类似的，大致分为五部分：</p>
<ul>
<li>头部（ <em>header</em> ），描述报文类型，以及其下 4 个小节的情况；</li>
<li>问题节（ <em>question</em> ），保存查询问题；</li>
<li>答案节（ <em>answer</em> ），保存问题答案，也就是查询结果；</li>
<li>授权信息节（ <em>authority</em> ），保存授权信息；</li>
<li>附加信息节（ <em>additional</em> ），保存附加信息；</li>
</ul>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605174159.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605174159.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>QR 位标记报文是一个查询请求，还是查询应答；
<ul>
<li>0 表示查询请求；</li>
<li>1 表示查询应答；</li>
</ul>
</li>
<li>操作码（<em>opcode</em>）占 4 位，表示操作类型；
<ul>
<li>0 是标准查询；</li>
<li>1 是反向查询；</li>
<li>2 是服务器状态请求；</li>
</ul>
</li>
<li>AA 表示 权威回答（<em>authoritative answer</em>），意味当前查询结果由域名的权威服务器给出；</li>
<li>TC 表示 截短（<em>truncated</em>），使用 UDP 时，如果应答超过 512 字节，只返回前 512 个字节；</li>
<li>RD 表示 期望递归（<em>recursion desired</em>），在请求中设置，并在应答中返回；
<ul>
<li>该位为 1 时，服务器必须处理这个请求：如果服务器没有授权回答，它必须替客户端请求其他 DNS 服务器，这也是所谓的 <strong>递归查询</strong> ；</li>
<li>该位为 0 时，如果服务器没有授权回答，它就返回一个能够处理该查询的服务器列表给客户端，由客户端自己进行 <strong>迭代查询</strong> ；</li>
</ul>
</li>
<li>RA 表示 可递归（<em>recursion available</em>），如果服务器支持递归查询，就会在应答中设置告知客户端；</li>
<li>保留位，未来扩展。</li>
<li>响应码（<em>response code</em>）表示请求结果；
<ul>
<li>0 表示没有差错；</li>
<li>3 表示名字差错，该差错由权威服务器返回，表示待查询的域名不存在；</li>
</ul>
</li>
</ul>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175006.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175006.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>问题节支持保存多条问题记录，记录条数则保存在 DNS 头部中的问题记录数字段。这意味着，DNS 协议单个请求能够同时查询多个域名，虽然通常只查询一个。</p>
<ul>
<li>待查域名（<em>Name</em>），字段长不固定。</li>
<li>查询类型（<em>Type</em>），除了关联 IP 地址，还可以关联其他信息常见类型包括：
<ul>
<li>1 表示 A 记录，即 IP 地址；</li>
<li>28 表示 AAAA 记录，即 IPv6 地址；</li>
</ul>
</li>
<li>类（<em>Class</em>）通常为 1，表示 TCP/IP 互联网地址；</li>
</ul>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175401.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175401.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>服务端处理查询请求后，需要向客户端发送应答报文；域名查询结果作为资源记录，保存在答案以及其后两节中.</p>
<ul>
<li><strong>有效期</strong>（ TTL ），域名记录一般不会频繁改动，所以在有效期内可以将结果缓存起来，降低请求频率；</li>
<li><strong>数据长度</strong>（ Resource Data Length ），即查询结果的长度；</li>
<li><strong>数据</strong>（ Resource Data ），即查询结果；</li>
</ul>
<p>1、请求报文实例。</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175659.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175659.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>2、应答报文实例</p>
<p><figure 
	>
	<a href="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175727.png" >
		<img src="https://yikuanwebsite.oss-cn-guangzhou.aliyuncs.com/img/20240605175727.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h2 id="附录补充知识点">附录：补充知识点</h2>
<h3 id="linux-内核---ioctl">Linux 内核 - <code>ioctl</code></h3>
<p><code>ioctl</code>是设备驱动程序中设备控制接口函数，一个字符设备驱动通常会实现设备打开、关闭、读、写等功能，如果需要扩展新的功能，通常以增设 <code>ioctl()</code> 命令的方式实现。</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;sys/ioctl.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">ioctl</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>, <span style="color:#e5c07b">int</span> <span style="color:#e06c75">cmd</span>, ...)
</span></span></code></pre></div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/2024/%E7%BD%91%E7%BB%9C%E6%95%B0%E9%80%9A%E5%85%A5%E9%97%A8/">
        
        
            <div class="article-image">
                <img src="/2024/%E7%BD%91%E7%BB%9C%E6%95%B0%E9%80%9A%E5%85%A5%E9%97%A8/cover.4cc458ef01bfdf6a62f7a77fea3abfcc_hud6534069964b1be15513fb0788602e96_1276815_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 网络数通入门"
                        data-key="网络数通入门" 
                        data-hash="md5-TMRY7wG/32pi96d/6jq/zA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">网络数通入门</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/2025/go%E5%8D%8F%E7%A8%8B%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B0/">
        
        
            <div class="article-image">
                <img src="/2025/go%E5%8D%8F%E7%A8%8B%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B0/cover.4869d41838bfe0e27948c414a193bc87_hu57bcf0b35e7c7f357025b7ed2d64bff5_607841_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Go协程交替打印"
                        data-key="Go协程交替打印" 
                        data-hash="md5-SGnUGDi/4OJ5SMQUoZO8hw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Go协程交替打印</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/2024/go%E4%B8%ADos.openfile%E8%AF%A6%E8%A7%A3/">
        
        
            <div class="article-image">
                <img src="/2024/go%E4%B8%ADos.openfile%E8%AF%A6%E8%A7%A3/cover.fb25058af774d2a70ccd6ebc665d1ec3_hu8c4fca34fb88be1a4ccda2cf04020a20_555523_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Go中os.OpenFile详解"
                        data-key="Go中os.OpenFile详解" 
                        data-hash="md5-&#43;yUFivd00qcMzW68Zl0eww==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Go中os.OpenFile详解</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
    .waline-container .vcount {
        color: var(--card-text-color-main);
    }
</style><script>
    
    new Waline({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili","https://npm.elemecdn.com/@waline/emojis@1.1.0/bmoji","https://npm.elemecdn.com/@waline/emojis@1.1.0/weibo"],"lang":"zh-CN","locale":{"admin":"站长","sofa":"还没有人评论哦！快来抢沙发吧~"},"placeholder":"欢迎留言！","requiredMeta":["name","email","url"],"serverURL":"https://vercel-db-yikuanzzs-projects.vercel.app/"});
</script>

    

    <footer class="site-footer">
  


    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


<script>
(function(u, c) {
  var d = document, t = 'script', o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
  o.src = u;
  if (c) { o.addEventListener('load', function(e) { c(e); }); }
  s.parentNode.insertBefore(o, s);
})('//cdn.bootcss.com/pangu/3.3.0/pangu.min.js', function() {
  pangu.spacingPage();
});
</script>

    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 <a href="https://yikuanzz.github.io//">Yikuanzz</a>·<i class="fas fa-bell"></i> <a id="days">0</a>Days<br>
      共书写了171.9k字·共 34篇文章</br><span><p>
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a><br />
         <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">© Licensed Under CC BY-NC-SA 4.0</a>
    </section>

<script>
var s1 = '2024-03-22';
s1 = new Date(s1.replace(/-/g, "/"));
s2 = new Date();
var days = s2.getTime() - s1.getTime();
var number_of_days = parseInt(days / (1000 * 60 * 60 * 24));
document.getElementById('days').innerHTML = number_of_days;
</script>
    
</footer>



    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
    
    
    <aside class="sidebar right-sidebar sticky">
        
            <form action="/search/" class="search-form widget" >
        <p>
            <label>Search</label>
            <input name="keyword" required placeholder="Type something..." />
        
            <button title="Search">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
        
            
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#概述">概述</a>
      <ol>
        <li><a href="#osi-参考模型">OSI 参考模型</a></li>
        <li><a href="#tcpip-协议栈">TCP/IP 协议栈</a></li>
      </ol>
    </li>
    <li><a href="#ethernet以太网协议">Ethernet：以太网协议</a>
      <ol>
        <li><a href="#物理层数据链路层">物理层+数据链路层</a></li>
        <li><a href="#以太网帧结构">以太网帧结构</a></li>
        <li><a href="#mac-地址">MAC 地址</a></li>
        <li><a href="#mtu-最大传输单元">MTU 最大传输单元</a></li>
        <li><a href="#编程发送以太网帧">编程发送以太网帧</a></li>
      </ol>
    </li>
    <li><a href="#ip互联网协议">IP：互联网协议</a>
      <ol>
        <li><a href="#网络层">网络层</a></li>
        <li><a href="#ip-包结构">IP 包结构</a></li>
        <li><a href="#ip-地址详解">IP 地址详解</a></li>
        <li><a href="#子网掩码">子网掩码</a></li>
        <li><a href="#ttlip-包存活时间">TTL，IP 包存活时间</a></li>
        <li><a href="#网络规划">网络规划</a></li>
      </ol>
    </li>
    <li><a href="#arp地址解析协议">ARP：地址解析协议</a>
      <ol>
        <li><a href="#arp-协议原理">ARP 协议原理</a></li>
        <li><a href="#arp-攻击">ARP 攻击</a></li>
      </ol>
    </li>
    <li><a href="#icmp互联网控制报文协议">ICMP：互联网控制报文协议</a>
      <ol>
        <li><a href="#icmp-协议概述">ICMP 协议概述</a></li>
      </ol>
    </li>
    <li><a href="#udp用户数据报协议">UDP：用户数据报协议</a>
      <ol>
        <li><a href="#传输层概述">传输层概述</a></li>
        <li><a href="#udp-数据报格式">UDP 数据报格式</a></li>
      </ol>
    </li>
    <li><a href="#tcp传输控制协议">TCP：传输控制协议</a>
      <ol>
        <li><a href="#tcp-协议简介">TCP 协议简介</a></li>
        <li><a href="#tcp-报文段格式">TCP 报文段格式</a></li>
        <li><a href="#三次握手">三次握手</a></li>
        <li><a href="#四次挥手">四次挥手</a></li>
        <li><a href="#滑动窗口tcp的流量控制">滑动窗口，TCP的流量控制</a></li>
        <li><a href="#拥塞窗口tcp的拥塞控制">拥塞窗口，TCP的拥塞控制</a></li>
      </ol>
    </li>
    <li><a href="#dns域名系统">DNS：域名系统</a>
      <ol>
        <li><a href="#域名系统的概述">域名系统的概述</a></li>
        <li><a href="#dns服务器工作原理">DNS服务器工作原理</a></li>
        <li><a href="#dns-报文格式">DNS 报文格式</a></li>
      </ol>
    </li>
    <li><a href="#附录补充知识点">附录：补充知识点</a>
      <ol>
        <li><a href="#linux-内核---ioctl">Linux 内核 - <code>ioctl</code></a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

        
            <section class="widget categories">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>


  
        </div> 
        <h2 class="widget-title section-title">Categories</h2>
    <div class="widget-categories--list">
<div class="widget">
    <h3 class="widget-title"> </h3>
    <div class="widget-body">
        <div class="category-list">
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="category-list-link">人工智能<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E5%BC%80%E5%8F%91%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/" class="category-list-link">开发运维技术<span class="category-list-count">6</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E6%8A%80%E6%9C%AF%E4%B8%8E%E6%95%88%E7%8E%87/" class="category-list-link">技术与效率<span class="category-list-count">17</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E6%95%B0%E5%AD%A6%E4%B8%8E%E7%89%A9%E7%90%86/" class="category-list-link">数学与物理<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="category-list-link">数据库<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="category-list-link">算法与数据结构<span class="category-list-count">4</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" class="category-list-link">语言学习<span class="category-list-count">4</a>
            </span></div>
        </div>
    </div>
</div>
    </div>
    </section>
        
            <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>



        </div>
        <h2 class="widget-title section-title">Archives</h2>

        
        
        
        
        
        <div class="widget-archive--list">
            <div class="archives-year">
                    <a href="/archives/#2025">
                        
                            <span class="year">2025</span>
                            <span class="count">1</span>
                        
                    </a> 
                </div>
            <div class="archives-year">
                    <a href="/archives/#2024">
                        
                            <span class="year">2024</span>
                            <span class="count">32</span>
                        
                    </a> 
                </div>
            
        </div>
    </section>
        
            <section class="widget tagCloud">
    <div class="widget-icon">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



    </div>
    <h2 class="widget-title section-title">Tags</h2>

    <div class="tagCloud-tags">
        
            <a href="/tags/note/" class="font_size_8">
                Note
            </a>
        
            <a href="/tags/linux/" class="font_size_3">
                Linux
            </a>
        
            <a href="/tags/web/" class="font_size_3">
                Web
            </a>
        
            <a href="/tags/%E8%8B%B1%E8%AF%AD/" class="font_size_3">
                英语
            </a>
        
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="font_size_3">
                计算机网络
            </a>
        
            <a href="/tags/c/" class="font_size_2">
                C
            </a>
        
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" class="font_size_2">
                计算机组成原理
            </a>
        
            <a href="/tags/mysql/" class="font_size_1">
                MySQL
            </a>
        
            <a href="/tags/python/" class="font_size_1">
                Python
            </a>
        
            <a href="/tags/shell/" class="font_size_1">
                Shell
            </a>
        
    </div>
</section>
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
