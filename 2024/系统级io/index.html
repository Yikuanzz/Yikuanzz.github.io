<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>
        <meta name='description' content='è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æ˜¯åœ¨ä¸»å­˜å’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´å¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä½¿ç”¨ç”±å†…æ ¸æä¾›çš„ç³»ç»Ÿçº§ Unix I/O å‡½æ•°æ¥å®ç°é«˜çº§åˆ«çš„ I/O å‡½æ•°ã€‚ Unix I/O ä¸€ä¸ª Linux æ–‡ä»¶'><title>ç³»ç»Ÿçº§IO</title>

<link rel='canonical' href='https://yikuanzz.github.io/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/'>

<link rel="stylesheet" href="/scss/style.min.46208cabd58e8bcef0cfb7d7ea6b561adcca3b91dd1fc6657493a44f03c5db75.css"><meta property='og:title' content='ç³»ç»Ÿçº§IO'>
<meta property='og:description' content='è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æ˜¯åœ¨ä¸»å­˜å’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´å¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä½¿ç”¨ç”±å†…æ ¸æä¾›çš„ç³»ç»Ÿçº§ Unix I/O å‡½æ•°æ¥å®ç°é«˜çº§åˆ«çš„ I/O å‡½æ•°ã€‚ Unix I/O ä¸€ä¸ª Linux æ–‡ä»¶'>
<meta property='og:url' content='https://yikuanzz.github.io/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/'>
<meta property='og:site_name' content='Yikuanzz'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Linux' /><meta property='article:tag' content='C' /><meta property='article:tag' content='è®¡ç®—æœºç½‘ç»œ' /><meta property='article:published_time' content='2024-06-06T10:53:23&#43;08:00'/><meta property='article:modified_time' content='2024-06-06T10:53:23&#43;08:00'/><meta property='og:image' content='https://yikuanzz.github.io/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/cover.png' />
<meta name="twitter:title" content="ç³»ç»Ÿçº§IO">
<meta name="twitter:description" content="è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æ˜¯åœ¨ä¸»å­˜å’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´å¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä½¿ç”¨ç”±å†…æ ¸æä¾›çš„ç³»ç»Ÿçº§ Unix I/O å‡½æ•°æ¥å®ç°é«˜çº§åˆ«çš„ I/O å‡½æ•°ã€‚ Unix I/O ä¸€ä¸ª Linux æ–‡ä»¶"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://yikuanzz.github.io/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/cover.png' />
    <link rel="shortcut icon" href="https://s2.loli.net/2024/03/22/Z5UYhgiHmGofML8.jpg" />
<style>
    :root {
        --article-font-family: "Noto Serif SC", var(--base-font-family);
    }
</style>

<script> 
		(function () {
		    const customFont = document.createElement('link');
		    customFont.href = "https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;700&display=swap"; 
		    customFont.type = "text/css";
		    customFont.rel = "stylesheet";
		
		    document.head.appendChild(customFont);
		}());
</script>

    </head>
    <body class="
    article-page
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    <!-- 
        extended
     -->
    on-phone--column extended
">
    
<div id="article-toolbar">
    <a href="https://yikuanzz.github.io/" class="back-home">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



        <span>Back</span>
    </a>
</div>
    <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/aa2_hue12ee8e79b9cb68bf5d1297bba3d9824_12551_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ§</span>
                
            </figure>
            
        
        
        <h1 class="site-name"><a href="/">Yikuanzz</a></h1>
        <h2 class="site-description">Anytimes you like.</h2><ol class="social-menu">
                
                    <li>
                        <a 
                            href='https://space.bilibili.com/15264235'
                            target="_blank"
                            title="Bilibili"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-bilibili" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#87CEFA" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" />
  <path d="M8 3l2 3" />
  <path d="M16 3l-2 3" />
  <path d="M9 13v-2" />
  <path d="M15 11v2" />
</svg>
                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://github.com/Yikuanzz'
                            target="_blank"
                            title="GitHub"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ff9300" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://leetcode.cn/u/yikuanzz/'
                            target="_blank"
                            title="Leetcode"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-leetcode" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ff2825" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 13h7.5" />
  <path d="M9.424 7.268l4.999 -4.999" />
  <path d="M16.633 16.644l-2.402 2.415a3.189 3.189 0 0 1 -4.524 0l-3.77 -3.787a3.223 3.223 0 0 1 0 -4.544l3.77 -3.787a3.189 3.189 0 0 1 4.524 0l2.302 2.313" />
</svg>
                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://www.zhihu.com/people/dolikes'
                            target="_blank"
                            title="Zhihu"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-zhihu" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#009988" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M14 6h6v12h-2l-2 2l-1 -2h-1z" />
  <path d="M4 12h6.5" />
  <path d="M10.5 6h-5" />
  <path d="M6 4c-.5 2.5 -1.5 3.5 -2.5 4.5" />
  <path d="M8 6v7c0 4.5 -2 5.5 -4 7" />
  <path d="M11 18l-3 -5" />
</svg>
                            
                        </a>
                    </li>
                
            </ol></header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>é¦–é¡µ</span>
            </a>
        </li>
        
        

        <li >
            <a href='/daily' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-book-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#C1C1C1" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M19 4v16h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12z" />
  <path d="M19 16h-12a2 2 0 0 0 -2 2" />
  <path d="M9 8h6" />
</svg>
                
                <span>æ—¥æŠ¥</span>
            </a>
        </li>
        
        

        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/">
                <img src="/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/cover_hub73ae7b0ed1c4909ac831706abf2ed8e_880514_800x0_resize_box_3.png"
                        srcset="/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/cover_hub73ae7b0ed1c4909ac831706abf2ed8e_880514_800x0_resize_box_3.png 800w, /2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/cover_hub73ae7b0ed1c4909ac831706abf2ed8e_880514_1600x0_resize_box_3.png 1600w"
                        width="800" 
                        height="420" 
                        loading="lazy"
                        alt="Featured image of post ç³»ç»Ÿçº§IO" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%BC%80%E5%8F%91%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/" style="background-color: #228B22; color: #fff;">
                å¼€å‘è¿ç»´æŠ€æœ¯
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/2024/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/">ç³»ç»Ÿçº§IO</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 06, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-words">
                    6084å­—
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    
    
    <p>è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æ˜¯åœ¨ä¸»å­˜å’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´å¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ã€‚</p>
<p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä½¿ç”¨ç”±å†…æ ¸æä¾›çš„ç³»ç»Ÿçº§ Unix I/O å‡½æ•°æ¥å®ç°é«˜çº§åˆ«çš„ I/O å‡½æ•°ã€‚</p>
<h2 id="unix-io">Unix I/O</h2>
<p>ä¸€ä¸ª Linux æ–‡ä»¶å°±æ˜¯ä¸€ä¸ª $m$ ä¸ªå­—èŠ‚çš„åºåˆ—ï¼š
$$
B_0, B_1,\dots,B_k,\dots,B_{m-1}
$$
æ‰€æœ‰çš„ I/O è®¾å¤‡è¢«æ¨¡å‹åŒ–ä¸ºæ–‡ä»¶ï¼Œè€Œæ‰€æœ‰çš„è¾“å…¥å’Œè¾“å‡ºéƒ½è¢«å½“ä½œå¯¹åº”æ–‡ä»¶çš„è¯»å†™æ¥æ‰§è¡Œï¼Œå…è®¸ Linux å†…æ ¸å¼•å‡ºä¸€ä¸ªç®€å•ã€ä½çº§çš„åº”ç”¨æ¥å£ï¼Œç§°ä¸º Unix I/Oï¼Œè¿™æ ·ä½¿æ‰€æœ‰çš„è¾“å…¥å’Œè¾“å‡ºèƒ½ç”¨ç»Ÿä¸€çš„æ–¹å¼æ¥æ‰§è¡Œï¼š</p>
<ul>
<li>æ‰“å¼€æ–‡ä»¶ï¼šç¨‹åºè¦æ±‚å†…æ ¸æ‰“å¼€æ–‡ä»¶ï¼Œå†…æ ¸ä¼šè¿”å›ä¸€ä¸ªå°çš„éè´Ÿæ•´æ•°çš„æè¿°ç¬¦ï¼Œå®ƒåœ¨åç»­å¯¹æ­¤æ–‡ä»¶çš„æ‰€æœ‰æ“ä½œä¸­æ ‡è¯†è¿™ä¸ªæ–‡ä»¶ã€‚</li>
<li>æ¯ä¸ªè¿›ç¨‹å¼€å§‹æ—¶æ‰“å¼€ä¸‰ä¸ªæ–‡ä»¶ï¼šæ ‡å‡†è¾“å…¥ï¼ˆæè¿°ç¬¦0ï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆæè¿°ç¬¦1ï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆæè¿°ç¬¦2ï¼‰ã€‚å¤´æ–‡ä»¶ <code>&lt;unistd.h&gt;</code> å®šä¹‰äº†å¸¸é‡ <code>STDIN_FILENO</code>ã€<code>STDOUT_FILENO</code> å’Œ <code>STDERR_FILENO</code>ã€‚</li>
<li>æ”¹å˜å½“å‰æ–‡ä»¶ä½ç½®ï¼šå¯¹äºæ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œå†…æ ¸ä¿æŒä¸€ä¸ªæ–‡ä»¶çš„ä½ç½® <code>k</code> ï¼Œåˆå§‹ä¸º 0ã€‚è¿™ä¸ªæ–‡ä»¶ä½ç½®æ˜¯ä»æ–‡ä»¶å¼€å¤´èµ·å§‹çš„å­—èŠ‚åç§»é‡ã€‚åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šè¿‡æ‰§è¡Œ <code>seek</code> æ“ä½œï¼Œè®¾ç½®æ–‡ä»¶çš„ä½ç½®ã€‚</li>
<li>è¯»å†™æ–‡ä»¶ï¼šä¸€ä¸ªè¯»æ“ä½œå°±æ˜¯ä»æ–‡ä»¶å¤åˆ¶ <code>n &gt; 0</code> ä¸ªå­—èŠ‚åˆ°å†…å­˜ï¼Œä»å½“å‰æ–‡ä»¶ä½ç½® <code>k</code> å¼€å§‹å¢åŠ åˆ° <code>k+n</code> ã€‚ç»™å®šä¸€ä¸ªå¤§å°ä¸º <code>m</code> å­—èŠ‚çš„æ–‡ä»¶ï¼Œå½“ <code>k &gt;= m</code> æ—¶æ‰§è¡Œè¯»æ“ä½œä¼šè§¦å‘ end-of-fileï¼ˆEOFï¼‰çš„æ¡ä»¶ã€‚é‚£ä¹ˆå†™æ“ä½œå°±æ˜¯ä»å†…å­˜å¤åˆ¶ <code>n &gt; 0</code> ä¸ªå­—èŠ‚åˆ°æ–‡ä»¶ã€‚</li>
<li>å…³é—­æ–‡ä»¶ï¼šç¨‹åºé€šçŸ¥å†…æ ¸å…³é—­è¿™ä¸ªæ–‡ä»¶ï¼Œå†…æ ¸ä¼šé‡Šæ”¾æ–‡ä»¶æ‰“å¼€æ—¶åˆ›å»ºçš„æ•°æ®ç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªæè¿°ç¬¦æ¢å¤åˆ°å¯ç”¨çš„æè¿°ç¬¦æ± ä¸­ã€‚</li>
</ul>
<h2 id="æ–‡ä»¶">æ–‡ä»¶</h2>
<p>æ–‡ä»¶ç±»å‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ™®é€šæ–‡ä»¶ï¼ˆregular fileï¼‰åŒ…å«ä»»æ„æ•°æ®ï¼Œé€šå¸¸åŒºåˆ†æ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚åªæ˜¯æ–‡æœ¬æ–‡ä»¶ä¸­æœ‰ ASCII æˆ– Unicode å­—ç¬¦ã€‚</li>
<li>ç›®å½•ï¼ˆdirectoryï¼‰æ˜¯åŒ…å«ä¸€ç»„é“¾æ¥ï¼ˆlinkï¼‰çš„æ–‡ä»¶ï¼Œæ¯ä¸ªé“¾æ¥éƒ½å°†ä¸€ä¸ªæ–‡ä»¶åæ˜ å°„åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªç›®å½•è‡³å°‘æœ‰ <code>.</code> å’Œ <code>..</code>ï¼Œä»£è¡¨å½“å‰ç›®å½•çš„é“¾æ¥å’Œåˆ°çˆ¶ç›®å½•çš„é“¾æ¥ã€‚</li>
<li>å¥—æ¥å­—ï¼ˆsocketï¼‰ç”¨æ¥ä¸å¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œè·¨ç½‘ç»œé€šä¿¡çš„æ–‡ä»¶ã€‚</li>
</ul>
<h2 id="æ‰“å¼€å’Œå…³é—­æ–‡ä»¶">æ‰“å¼€å’Œå…³é—­æ–‡ä»¶</h2>
<p>è¿›ç¨‹é€šè¿‡ <code>open</code> å‡½æ•°æ¥æ‰“å¼€æˆ–åˆ›å»ºæ–‡ä»¶çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;sys/types.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;sys/stat.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;fcntl.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e">// æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå‡ºé”™è¿”å› -1
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">open</span>(<span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">filename</span>, <span style="color:#e5c07b">int</span> <span style="color:#e06c75">flags</span>, <span style="color:#e5c07b">mode_t</span> <span style="color:#e06c75">mode</span>);	
</span></span></code></pre></div><p><code>flags</code> å‚æ•°å¯é€‰ï¼š</p>
<ul>
<li>O_RDONLYï¼šåªè¯»ã€‚</li>
<li>O_WRONLYï¼šåªå†™ã€‚</li>
<li>O_RDWRï¼šå¯è¯»å¯å†™ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">fd</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">open</span>(<span style="color:#98c379">&#34;foo.txt&#34;</span>, <span style="color:#e06c75">O_RDONLY</span>, <span style="color:#d19a66">0</span>);
</span></span></code></pre></div><p><code>flags</code> å‚æ•°æ˜¯å¤šä½æ©ç çš„æˆ–ï¼š</p>
<ul>
<li>O_CRETEï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ã€‚</li>
<li>O_TRUNCï¼šå¦‚æœæ–‡ä»¶å­˜åœ¨å°±æˆªæ–­ã€‚</li>
<li>O_APPENDï¼šå†™æ“ä½œæ—¶è®¾ç½®æ–‡ä»¶ä½ç½®åˆ°æ–‡ä»¶ç»“å°¾ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">fd</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">open</span>(<span style="color:#98c379">&#34;foo.txt&#34;</span>, <span style="color:#e06c75">O_WRONLY</span><span style="color:#56b6c2">|</span><span style="color:#e06c75">O_APPEND</span>, <span style="color:#d19a66">0</span>);
</span></span></code></pre></div><p><code>mode</code> å‚æ•°æŒ‡å®šäº†æ–°æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚</p>
<blockquote>
<p><strong>umask</strong></p>
<p>åœ¨ Linux ä¸­ï¼Œumsak ç”¨äºè®¾ç½®æ–°å»ºæ–‡ä»¶å’Œç›®å½•çš„é»˜è®¤æƒé™ã€‚å®ƒç”±3ä½å…«è¿›åˆ¶æ•°è¡¨ç¤ºï¼Œåˆ†åˆ«è¡¨ç¤ºç”¨æˆ·ã€ç»„å’Œå…¶ä»–ç”¨æˆ·çš„æƒé™æ©ç ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># define DEF_MODE S_IRUSR|S_IWUSR|S_IROTH|S_IWOTH
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># define DEF_UMASK S_IWGRP|S_IWOTH
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#61afef;font-weight:bold">umask</span>(<span style="color:#e06c75">DEF_UMASK</span>);
</span></span><span style="display:flex;"><span><span style="color:#e06c75">fd</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">open</span>(<span style="color:#98c379">&#34;foo.txt&#34;</span>, <span style="color:#e06c75">O_CREAT</span><span style="color:#56b6c2">|</span><span style="color:#e06c75">O_TRUNC</span><span style="color:#56b6c2">|</span><span style="color:#e06c75">O_WRONLY</span>, <span style="color:#e06c75">DEF_MODE</span>);
</span></span></code></pre></div><p>æœ€åè¿›ç¨‹é€šè¿‡ <code>close</code> å‡½æ•°å…³é—­æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;unisted.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#7f848e">// æˆåŠŸè¿”å› 0ï¼Œ å¦åˆ™è¿”å› -1
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">close</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>);
</span></span></code></pre></div><h2 id="è¯»å’Œå†™æ–‡ä»¶">è¯»å’Œå†™æ–‡ä»¶</h2>
<p>é€šè¿‡è°ƒç”¨ read å’Œ write å‡½æ•°æ¥æ‰§è¡Œè¯»å†™ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;unistd.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e">// æˆåŠŸè¿”å›è¯»çš„å­—èŠ‚æ•°ï¼›EOF ä¸º 0ï¼›å‡ºé”™ -1
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">read</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>, <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">buf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">n</span>);
</span></span><span style="display:flex;"><span><span style="color:#7f848e">// æˆåŠŸè¿”å›å†™çš„å­—èŠ‚æ•°ï¼Œé”™ä¸º -1.
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">write</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>, <span style="color:#c678dd">const</span> <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">buf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">n</span>);
</span></span></code></pre></div><blockquote>
<p><strong>size_t</strong> å’Œ <strong>ssize_t</strong></p>
<ul>
<li><code>size_t</code> ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºä¸€ç§è®¡æ•°ï¼Œæ¯”å¦‚æœ‰å¤šå°‘ä¸œè¥¿è¢«æ‹·è´ç­‰ã€‚å®ƒåœ¨æ•°ç»„ä¸‹æ ‡å’Œå†…å­˜ç®¡ç†å‡½æ•°ç­‰åœ°æ–¹å¹¿æ³›ä½¿ç”¨ã€‚</li>
<li><code>ssize_t</code> ç”¨æ¥è¡¨ç¤ºå¯ä»¥è¢«æ‰§è¡Œè¯»å†™æ“ä½œçš„æ•°æ®å—çš„å¤§å°ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯<strong>æœ‰ç¬¦å·çš„ size_t ç±»å‹</strong>ã€‚</li>
</ul>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5c07b">char</span> <span style="color:#e06c75">c</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">while</span> (<span style="color:#61afef;font-weight:bold">read</span>(<span style="color:#e06c75">STDIN_FILENO</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">c</span>, <span style="color:#d19a66">1</span>) <span style="color:#56b6c2">!=</span> <span style="color:#d19a66">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">write</span>(<span style="color:#e06c75">STDOU_FILENO</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">c</span>, <span style="color:#d19a66">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#61afef;font-weight:bold">exit</span>(<span style="color:#d19a66">0</span>);
</span></span></code></pre></div><h2 id="rio-å¥å£®åœ°è¯»å†™">RIO å¥å£®åœ°è¯»å†™</h2>
<p>RIOï¼ˆRobust I/Oï¼‰æä¾›äº†ä¸¤ç§å‡½æ•°å¤„ç†ä¸è¶³å€¼ï¼ˆshort countï¼‰ã€‚</p>
<p><strong>æ— ç¼“å†²è¾“å…¥è¾“å‡º</strong>ï¼šç›´æ¥åœ¨å†…å­˜å’Œæ–‡ä»¶ä¹‹é—´ä¼ é€æ•°æ®ï¼Œæ²¡æœ‰åº”ç”¨çº§ç¼“å†²ã€‚</p>
<p><code>rio_readn</code> å‡½æ•°ï¼š</p>
<ul>
<li>æ­¤å‡½æ•°å°è¯•ä»æ–‡ä»¶æè¿°ç¬¦ <code>fd</code> ä¸­è¯»å– <code>n</code> ä¸ªå­—ç¬¦åˆ°ç”¨æˆ·ç¼“å†²åŒº <code>usrbuf</code> ä¸­ã€‚</li>
<li>å¦‚æœè¢«ä¿¡å·å¤„ç†å‡½æ•°ä¸­æ–­ï¼Œå®ƒä¼šå†æ¬¡å°è¯•è¯»å–ï¼Œç¡®ä¿è¯»å–åˆ° <code>n</code> ä¸ªå­—èŠ‚ã€‚</li>
<li>ä¸æ™®é€šçš„ <code>read</code> å‡½æ•°ä¸åŒï¼Œ<code>rio_readn</code> è§£å†³äº†åœ¨ç½‘ç»œç¼–ç¨‹ä¸­å¯èƒ½è¯»å–åˆ°çš„å­—èŠ‚æ•°å°‘äºè¯·æ±‚æ•°é‡çš„é—®é¢˜ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e">// æˆåŠŸè¿”å›è¯»çš„å­—èŠ‚æ•°ï¼›EOF ä¸º 0ï¼›å‡ºé”™ -1
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">rio_readn</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>, <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">usrbuf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">n</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">n</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">ssize_t</span> <span style="color:#e06c75">nread</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">usrbuf</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">while</span> (<span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">if</span> ((<span style="color:#e06c75">nread</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">read</span>(<span style="color:#e06c75">fd</span>, <span style="color:#e06c75">bufp</span>, <span style="color:#e06c75">nleft</span>)) <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">if</span> (<span style="color:#e06c75">errno</span> <span style="color:#56b6c2">==</span> <span style="color:#e06c75">EINTR</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#e06c75">nread</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>; <span style="color:#7f848e">// è¢«ä¿¡å·å¤„ç†å‡½æ•°ä¸­æ–­ï¼Œå†æ¬¡å°è¯•è¯»å–
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#c678dd">return</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>; <span style="color:#7f848e">// å‡ºé”™ï¼Œerrno ç”± read è®¾ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>        } <span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">nread</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">0</span>) <span style="color:#7f848e">// è¯»å–åˆ° EOF
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#c678dd">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">-=</span> <span style="color:#e06c75">nread</span>; <span style="color:#7f848e">// å‰©ä¸‹çš„å­—ç¬¦æ•°å‡å»æœ¬æ¬¡è¯»åˆ°çš„å­—ç¬¦æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>        <span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">nread</span>; <span style="color:#7f848e">// ç¼“å†²åŒºæŒ‡é’ˆå‘å³ç§»åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> (<span style="color:#e06c75">n</span> <span style="color:#56b6c2">-</span> <span style="color:#e06c75">nleft</span>); <span style="color:#7f848e">// è¿”å›å®é™…è¯»å–çš„å­—ç¬¦æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>}
</span></span></code></pre></div><p><code>rio_writen</code> å‡½æ•°ï¼š</p>
<ul>
<li>æ­¤å‡½æ•°ç±»ä¼¼äº <code>rio_readn</code>ï¼Œä½†ç”¨äºå†™å‡ºæ•°æ®ã€‚</li>
<li>å®ƒä¿è¯å†™å‡º <code>n</code> å­—èŠ‚ï¼Œä¸ä¼šè¿”å›ä¸è¶³å€¼ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e">// æˆåŠŸè¿”å›å†™çš„å­—èŠ‚æ•°ï¼Œé”™ä¸º -1.
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">rio_writen</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>, <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">usrbuf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">n</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">n</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">ssize_t</span> <span style="color:#e06c75">nwritten</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">usrbuf</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">while</span> (<span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">if</span> ((<span style="color:#e06c75">nwritten</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">write</span>(<span style="color:#e06c75">fd</span>, <span style="color:#e06c75">bufp</span>, <span style="color:#e06c75">nleft</span>)) <span style="color:#56b6c2">&lt;=</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">if</span> (<span style="color:#e06c75">errno</span> <span style="color:#56b6c2">==</span> <span style="color:#e06c75">EINTR</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#e06c75">nwritten</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#c678dd">return</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">-=</span> <span style="color:#e06c75">nwritten</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">nwritten</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#e06c75">n</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>å¸¦ç¼“å†²å¸¦è¾“å…¥</strong>ï¼š</p>
<p><code>rio_readlineb</code> ä»å†…éƒ¨è¯»ç¼“å†²åŒºå¤åˆ¶ä¸€ä¸ªæ–‡æœ¬è¡Œï¼Œå½“ç¼“å†²åŒºå˜ç©ºæ—¶ï¼Œä¼šè‡ªåŠ¨åœ°è°ƒç”¨ <code>read</code> é‡æ–°å¡«æ»¡ç¼“å†²åŒºï¼Œå¦‚æœæ–‡ä»¶æ—¢åŒ…å« æ–‡æœ¬è¡Œä¹ŸäºŒè¿›åˆ¶æ•°æ®æ–‡ä»¶ï¼Œå°±ç”¨ <code>rio_readn</code> çš„ç¼“å†²ç‰ˆæœ¬ <code>rio_readnb</code>ï¼Œå®ƒä»å’Œ <code>rio_readlineb</code> ä¸€æ ·çš„ç¼“å†²åŒºä¸­ä¼ é€åŸå§‹å­—èŠ‚ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5c07b">void</span> <span style="color:#61afef;font-weight:bold">rio_readinitb</span>(<span style="color:#e5c07b">rio_t</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rp</span>, <span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>);
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">rio_readlineb</span>(<span style="color:#e5c07b">rio_t</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rp</span>, <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">usrbuf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">maxlen</span>);
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">rio_readnb</span>(<span style="color:#e5c07b">rio_t</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rp</span>, <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">userbuf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">n</span>);
</span></span></code></pre></div><p>æ¯æ‰“å¼€ä¸€ä¸ªæè¿°ç¬¦ï¼Œéƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ <code>rio_readinitb</code> å‡½æ•°ï¼Œå®ƒå°†æè¿°ç¬¦ <code>fd</code> å’Œ åœ°å€ <code>rp</code> å¤„çš„ä¸€ä¸ªç±»å‹ä¸º <code>rio_t</code> çš„ç¼“å†²åŒºè”ç³»èµ·æ¥ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># define RIO_BUFSIZE 8192
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#c678dd">typedef</span> <span style="color:#c678dd">struct</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">int</span> <span style="color:#e06c75">rio_fd</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">int</span> <span style="color:#e06c75">rio_cnt</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rio_bufptr</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#e06c75">rio_buf</span>[<span style="color:#e06c75">RIO_BUFSIZE</span>];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">void</span> <span style="color:#61afef;font-weight:bold">rio_readinitb</span>(<span style="color:#e5c07b">rio_t</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rp</span>, <span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_fd</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">fd</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">fio_cnt</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_bufptr</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_buf</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>rio_readlineb</code> å‡½æ•°ä»æ–‡ä»¶ <code>rp</code> è¯»å‡ºä¸‹ä¸€ä¸ªæ–‡æœ¬è¡Œï¼ˆåŒ…æ‹¬ç»“å°¾çš„æ¢è¡Œç¬¦ï¼‰ï¼Œå¤åˆ¶åˆ° <code>usrbuf</code> ï¼Œå¹¶ç”¨ NULL å­—ç¬¦æ¥ç»“æŸè¿™ä¸ªæ–‡æœ¬è¡Œã€‚è¶…è¿‡ <code>maxlen-1</code> çš„æ–‡æœ¬è¡Œä¼šè¢«æˆªæ–­ï¼Œå¹¶ç”¨ä¸€ä¸ª NULL å­—ç¬¦ç»“æŸã€‚</p>
<p>æ³¨æ„ï¼šå¸¦ç¼“å†²çš„å‡½æ•°è°ƒç”¨ä¸åº”è¯¥å’Œæ— ç¼“å†²çš„ <code>rio_readn</code> äº¤å‰è°ƒç”¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">argc</span>, <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">**</span><span style="color:#e06c75">argv</span>){
</span></span><span style="display:flex;"><span>	<span style="color:#e5c07b">int</span> <span style="color:#e06c75">n</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">rio_t</span> <span style="color:#e06c75">rio</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#e06c75">buf</span>[<span style="color:#e06c75">MAXLINE</span>];
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// å…ˆåˆå§‹åŒ–å°†æ•°æ®è¯»å–åˆ°å†…ç½®çš„ç¼“å†²åŒºä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#61afef;font-weight:bold">Rio_readinitb</span>(<span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">rio</span>, <span style="color:#e06c75">STDIN_FILENO</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">while</span> ((<span style="color:#e06c75">n</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">Rio_readlineb</span>(<span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">rio</span>, <span style="color:#e06c75">buf</span>, <span style="color:#e06c75">MAXLINE</span>)) <span style="color:#56b6c2">!=</span> <span style="color:#d19a66">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#61afef;font-weight:bold">Rio_write</span>(<span style="color:#e06c75">STDOUT_FILENO</span>, <span style="color:#e06c75">buf</span>, <span style="color:#e06c75">n</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹ <code>rio_read</code> å‡½æ•°çš„å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#c678dd">static</span> <span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">rio_read</span>(<span style="color:#e5c07b">rio_t</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rp</span>, <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">usrbuf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">n</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">int</span> <span style="color:#e06c75">cnt</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// å¤„ç†ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#c678dd">while</span> (<span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_cnt</span> <span style="color:#56b6c2">&lt;=</span> <span style="color:#d19a66">0</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#7f848e">// ç”¨ read è¯»å–åˆ°ç¼“å†²åŒºä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>        <span style="color:#e06c75">rp</span> <span style="color:#56b6c2">-&gt;</span> <span style="color:#e06c75">rio_cnt</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">read</span>(<span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_fd</span>, <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_buf</span>, <span style="color:#c678dd">sizeof</span>(<span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_buf</span>));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">if</span> (<span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_cnt</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">if</span> (<span style="color:#e06c75">errno</span> <span style="color:#56b6c2">!=</span> <span style="color:#e06c75">EINTR</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#c678dd">return</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>   
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">rp</span> <span style="color:#56b6c2">-&gt;</span> <span style="color:#e06c75">rio_cnt</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">return</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7f848e">// åŠ è½½æˆåŠŸåé‡ç½® buffer åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_bufptr</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_buf</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// å°†æ•°æ®ä»ç¼“å†²åŒºå¤åˆ¶åˆ°ç”¨æˆ·ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#e06c75">cnt</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">n</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_cnt</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#e06c75">n</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">cnt</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">rp</span> <span style="color:#56b6c2">-&gt;</span> <span style="color:#e06c75">rio_cnt</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">memcpy</span>(<span style="color:#e06c75">usrbuf</span>, <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_bufptr</span>, <span style="color:#e06c75">cnt</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_bufptr</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">n</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">rp</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">rio_cnt</span> <span style="color:#56b6c2">-=</span> <span style="color:#e06c75">cnt</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#e06c75">cnt</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p><strong>errno</strong></p>
<p>errno æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œç”¨äºè¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡å‘ç”Ÿçš„é”™è¯¯ä»£ç ï¼Œå®ƒè¢«å®šä¹‰åœ¨ errno.h å¤´æ–‡ä»¶ä¸­ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å†çœ‹åˆ° <code>rio_readlineb</code> å‡½æ•°å’Œ <code>rio_readnb</code> å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">rio_readlineb</span>(<span style="color:#e5c07b">rio_t</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rp</span>, <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">usrbuf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">maxlen</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">int</span> <span style="color:#e06c75">n</span>, <span style="color:#e06c75">rc</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#e06c75">c</span>, <span style="color:#56b6c2">*</span><span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">usrbuf</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">for</span> (<span style="color:#e06c75">n</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">1</span>; <span style="color:#e06c75">n</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#e06c75">maxlen</span>; <span style="color:#e06c75">n</span><span style="color:#56b6c2">++</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">if</span> ((<span style="color:#e06c75">rc</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">rio_read</span>(<span style="color:#e06c75">rp</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">c</span>, <span style="color:#d19a66">1</span>)) <span style="color:#56b6c2">==</span> <span style="color:#d19a66">1</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#56b6c2">*</span><span style="color:#e06c75">bufp</span><span style="color:#56b6c2">++</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">c</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">if</span> (<span style="color:#e06c75">c</span> <span style="color:#56b6c2">==</span> <span style="color:#98c379">&#39;\n&#39;</span>){
</span></span><span style="display:flex;"><span>                <span style="color:#e06c75">n</span><span style="color:#56b6c2">++</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#c678dd">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }<span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">rc</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">if</span> (<span style="color:#e06c75">n</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">1</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#c678dd">return</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#c678dd">break</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">return</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#56b6c2">*</span><span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#e06c75">n</span><span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5c07b">ssize_t</span> <span style="color:#61afef;font-weight:bold">rio_readnb</span>(<span style="color:#e5c07b">rio_t</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">rp</span>, <span style="color:#e5c07b">void</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">usrbuf</span>, <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">n</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">size_t</span> <span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">n</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">ssize_t</span> <span style="color:#e06c75">nread</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">usrbuf</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">while</span> (<span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">0</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">if</span> ((<span style="color:#e06c75">nread</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">rio_read</span>(<span style="color:#e06c75">rp</span>, <span style="color:#e06c75">bufp</span>, <span style="color:#e06c75">nleft</span>)) <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">return</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span>(<span style="color:#e06c75">nread</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">nleft</span> <span style="color:#56b6c2">-=</span> <span style="color:#e06c75">nread</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">bufp</span> <span style="color:#56b6c2">+=</span> <span style="color:#e06c75">nread</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> (<span style="color:#e06c75">n</span> <span style="color:#56b6c2">-</span> <span style="color:#e06c75">nleft</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>â€‹</p>
<h2 id="è¯»å–æ–‡ä»¶å…ƒæ•°æ®">è¯»å–æ–‡ä»¶å…ƒæ•°æ®</h2>
<p>æ£€ç´¢å…³äºæ–‡ä»¶çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å…ƒæ•°æ®ï¼ˆmeta dataï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;unistd.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;sys/stata.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">stat</span>(<span style="color:#c678dd">const</span> <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">filename</span>, <span style="color:#c678dd">struct</span> <span style="color:#e06c75">stat</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">buf</span>);
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">fstat</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd</span>, <span style="color:#c678dd">struct</span> <span style="color:#e06c75">stat</span><span style="color:#56b6c2">*</span><span style="color:#e06c75">buf</span>);
</span></span></code></pre></div><p><figure 
	>
	<a href="https://s2.loli.net/2024/03/28/Ld49EStXOUBvJAR.png" >
		<img src="https://s2.loli.net/2024/03/28/Ld49EStXOUBvJAR.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><code>st_size</code> æˆå‘˜åŒ…å«äº†æ–‡ä»¶çš„å­—èŠ‚æ•°å¤§å°ã€‚<code>st_mode</code> æˆå‘˜ç¼–ç äº†æ–‡ä»¶è®¿é—®è®¸å¯ä½å’Œæ–‡ä»¶ç±»å‹ï¼Œå®ƒçš„ä½9ä½æ ‡è¯†äº†æ–‡ä»¶æ‰€æœ‰è€…ã€ç»„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·çš„è¯»å†™æ‰§è¡Œæƒé™ã€‚</p>
<p>è¿™äº›æƒé™ä½çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ–‡ä»¶ç±»å‹ï¼š
<ul>
<li><code>S_IFIFO</code>ï¼šç®¡é“æˆ– FIFO æ–‡ä»¶ã€‚</li>
<li><code>S_IFCHR</code>ï¼šå­—ç¬¦ç‰¹æ®Šæ–‡ä»¶ã€‚</li>
<li><code>S_IFDIR</code>ï¼šç›®å½•æ–‡ä»¶ã€‚</li>
<li><code>S_IFBLK</code>ï¼šå—ç‰¹æ®Šæ–‡ä»¶ã€‚</li>
<li><code>S_IFREG</code>ï¼šæ™®é€šæ–‡ä»¶ã€‚</li>
<li><code>S_IFLNK</code>ï¼šé“¾æ¥æ–‡ä»¶ã€‚</li>
<li><code>S_IFSOCK</code>ï¼šå¥—æ¥å­—ã€‚</li>
</ul>
</li>
<li>æ–‡ä»¶è®¿é—®æƒé™æ§åˆ¶ï¼š
<ul>
<li><code>S_ISVTX</code>ï¼šç²˜ä½ä½ã€‚</li>
<li><code>S_ISGID</code>ï¼šå°†è¿›ç¨‹çš„æœ‰æ•ˆç»„ ID è®¾ç½®ä¸ºæ–‡ä»¶çš„ç»„æ‰€æœ‰è€… IDã€‚</li>
<li><code>S_ISUID</code>ï¼šå°†è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ· ID è®¾ç½®ä¸ºæ–‡ä»¶çš„ç”¨æˆ· IDã€‚</li>
</ul>
</li>
<li>æ–‡ä»¶è®¿é—®æƒé™ï¼š
<ul>
<li><code>S_IXOTH</code>ï¼šå…¶ä»–ç”¨æˆ·å¯æ‰§è¡Œã€‚</li>
<li><code>S_IWOTH</code>ï¼šå…¶ä»–ç”¨æˆ·å¯å†™ã€‚</li>
<li><code>S_IROTH</code>ï¼šå…¶ä»–ç”¨æˆ·å¯è¯»ã€‚</li>
<li><code>S_IXGRP</code>ï¼šç»„ç”¨æˆ·å¯æ‰§è¡Œã€‚</li>
<li><code>S_IWGRP</code>ï¼šç»„ç”¨æˆ·å¯å†™ã€‚</li>
<li><code>S_IRGRP</code>ï¼šç»„ç”¨æˆ·å¯è¯»ã€‚</li>
<li><code>S_IXUSR</code>ï¼šæ–‡ä»¶æ‰€æœ‰è€…å¯æ‰§è¡Œã€‚</li>
<li><code>S_IWUSR</code>ï¼šæ–‡ä»¶æ‰€æœ‰è€…å¯å†™ã€‚</li>
<li><code>S_IRUSR</code>ï¼šæ–‡ä»¶æ‰€æœ‰è€…å¯è¯»ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>ç²˜ä½ä½</strong>ï¼ˆä¹Ÿç§°ä¸º<strong>é»æ»ä½</strong>ï¼‰æ˜¯ Unix æ–‡ä»¶ç³»ç»Ÿæƒé™çš„ä¸€ä¸ªç‰¹æ®Šæ ‡å¿—ã€‚å®ƒåœ¨æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ä¸­èµ·åˆ°é‡è¦ä½œç”¨ã€‚</p>
<ol>
<li><strong>æ–‡ä»¶çš„ç²˜ä½ä½</strong>ï¼š
<ul>
<li>å¦‚æœä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºæ–‡ä»¶è®¾ç½®äº†ç²˜ä½ä½ï¼Œé‚£ä¹ˆåœ¨è¯¥ç¨‹åºç¬¬ä¸€æ¬¡æ‰§è¡Œå¹¶ç»“æŸæ—¶ï¼Œè¯¥ç¨‹åºæ­£æ–‡çš„ä¸€éƒ¨åˆ†ä¼šè¢«ä¿å­˜åœ¨äº¤æ¢åŒºï¼ˆswap spaceï¼‰ä¸­ã€‚</li>
<li>æ­£æ–‡éƒ¨åˆ†æŒ‡çš„æ˜¯æœºå™¨æŒ‡ä»¤éƒ¨åˆ†ï¼Œè¿™ä½¿å¾—ä¸‹æ¬¡æ‰§è¡Œè¯¥ç¨‹åºæ—¶èƒ½æ›´å¿«åœ°å°†å…¶è£…å…¥å†…å­˜åŒºã€‚</li>
<li>åœ¨äº¤æ¢åŒºä¸­ï¼Œæ–‡ä»¶æ˜¯è¿ç»­å­˜æ”¾çš„ï¼Œè€Œåœ¨ä¸€èˆ¬çš„ Unix æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶çš„å„æ•°æ®å—å¾ˆå¯èƒ½æ˜¯éšæœºå­˜æ”¾çš„ã€‚</li>
<li>å¸¸ç”¨çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æ–‡æœ¬ç¼–è¾‘ç¨‹åºå’Œç¼–è¯‘ç¨‹åºï¼Œé€šå¸¸è®¾ç½®äº†å®ƒä»¬æ‰€åœ¨æ–‡ä»¶çš„ç²˜ä½ä½ã€‚</li>
<li>ç°ä»Šè¾ƒæ–°çš„ Unix ç³»ç»Ÿå¤§å¤šæ•°éƒ½å…·æœ‰è™šå­˜ç³»ç»Ÿä»¥åŠå¿«é€Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥ä¸å†éœ€è¦ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚</li>
</ul>
</li>
<li><strong>ç›®å½•çš„ç²˜ä½ä½</strong>ï¼š
<ul>
<li>åœ¨ç›®å½•ä¸Šè®¾ç½®ç²˜ä½ä½ï¼Œåªæœ‰å¯¹è¯¥ç›®å½•å…·æœ‰å†™è®¸å¯æƒçš„ç”¨æˆ·å¹¶ä¸”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€ï¼Œæ‰èƒ½åˆ é™¤æˆ–æ›´åè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š
<ul>
<li>æ‹¥æœ‰æ­¤æ–‡ä»¶ã€‚</li>
<li>æ‹¥æœ‰æ­¤ç›®å½•ã€‚</li>
<li>æ˜¯è¶…çº§ç”¨æˆ·ã€‚</li>
</ul>
</li>
<li>ä¾‹å¦‚ï¼Œç›®å½• <code>/tmp</code> å’Œ <code>/var/spool/uucp/public</code> æ˜¯è®¾ç½®ç²˜ä½ä½çš„å€™é€‰è€…ï¼Œè¿™ä¸¤ä¸ªç›®å½•æ˜¯ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºæ–‡ä»¶çš„ç›®å½•ã€‚</li>
<li>è¿™ä¸¤ä¸ªç›®å½•å¯¹ä»»ä¸€ç”¨æˆ·ï¼ˆç”¨æˆ·ã€ç»„å’Œå…¶ä»–ï¼‰çš„è®¸å¯æƒé€šå¸¸éƒ½æ˜¯è¯»ã€å†™å’Œæ‰§è¡Œã€‚ä½†æ˜¯ç”¨æˆ·ä¸åº”èƒ½åˆ é™¤æˆ–æ›´åå±äºå…¶ä»–äººçš„æ–‡ä»¶ï¼Œå› æ­¤åœ¨è¿™ä¸¤ä¸ªç›®å½•çš„æ–‡ä»¶ä¸Šéƒ½è®¾ç½®äº†ç²˜ä½ä½ã€‚</li>
</ul>
</li>
</ol>
</blockquote>
<p>Linux åœ¨ <code>sys/stat.h</code> ä¸­å®šä¹‰äº†å®æ¥å»å®š <code>st_mode</code> æˆå‘˜çš„æ–‡ä»¶ç±»å‹ï¼š</p>
<ul>
<li>S_ISREG(m)ã€‚è¿™æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶å—ï¼Ÿ</li>
<li>S_ISDIR(m)ã€‚è¿™æ˜¯ä¸€ä¸ªç›®å½•æ–‡ä»¶å—ï¼Ÿ</li>
<li>S_ISSOCK(m)ã€‚è¿™æ˜¯ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—å—ï¼Ÿ</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">argc</span>, <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">**</span><span style="color:#e06c75">argv</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">struct</span> <span style="color:#e06c75">stat</span> <span style="color:#e06c75">stat</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">type</span>, <span style="color:#56b6c2">*</span><span style="color:#e06c75">readok</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">Stat</span>(<span style="color:#e06c75">argv</span>[<span style="color:#d19a66">1</span>], <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">stat</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#61afef;font-weight:bold">S_ISREG</span>(<span style="color:#e06c75">stat</span>.<span style="color:#e06c75">st_mode</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">type</span> <span style="color:#56b6c2">=</span> <span style="color:#98c379">&#34;regular&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span> (<span style="color:#61afef;font-weight:bold">S_ISDIR</span>(<span style="color:#e06c75">stat</span>.<span style="color:#e06c75">st_mode</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">type</span> <span style="color:#56b6c2">=</span> <span style="color:#98c379">&#34;directory&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">type</span> <span style="color:#56b6c2">=</span> <span style="color:#98c379">&#34;other&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> ((<span style="color:#e06c75">stat</span>.<span style="color:#e06c75">st_mode</span> <span style="color:#56b6c2">&amp;</span> <span style="color:#e06c75">S_IRUSR</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">redok</span> <span style="color:#56b6c2">=</span> <span style="color:#98c379">&#34;yes&#34;</span>;
</span></span><span style="display:flex;"><span>   	<span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e06c75">readok</span> <span style="color:#56b6c2">=</span> <span style="color:#98c379">&#34;no&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;type: %s, read: %s</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#e06c75">type</span>, <span style="color:#e06c75">readok</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">exit</span>(<span style="color:#d19a66">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="è¯»å–ç›®å½•å†…å®¹">è¯»å–ç›®å½•å†…å®¹</h2>
<p>ç”¨ <code>readdir</code> ç³»åˆ—å‡½æ•°æ¥è¯»å–ç›®å½•çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;sys/types.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;dirent.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e">// æˆåŠŸè¿”å›å¤„ç†çš„æŒ‡é’ˆï¼›å‡ºé”™ä¸ºNULL
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e06c75">DIR</span> <span style="color:#56b6c2">*</span><span style="color:#61afef;font-weight:bold">opendir</span>(<span style="color:#c678dd">const</span> <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">name</span>);
</span></span></code></pre></div><p>å‡½æ•° <code>opendir</code> ä»¥è·¯å¾„åä¸ºå‚æ•°ï¼Œè¿”å›æŒ‡å‘ç›®å½•æµï¼ˆdirectory streamï¼‰çš„æŒ‡é’ˆï¼Œæµæ˜¯å¯¹æ¡ç›®æœ‰åºåˆ—è¡¨çš„æŠ½è±¡ï¼Œåœ¨è¿™é‡ŒæŒ‡ç›®å½•é¡¹çš„åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;dirent.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#7f848e">// æˆåŠŸåˆ™ä¸ºæŒ‡å‘ä¸‹ä¸€ä¸ªç›®å½•é¡¹çš„æŒ‡é’ˆæ²¡æœ‰æ›´å¤šç›®å½•æˆ–å‡ºé”™å°±ä¸ºNULLå¹¶è®¾ç½®errno
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#c678dd">struct</span> <span style="color:#e06c75">dirent</span> <span style="color:#56b6c2">*</span><span style="color:#61afef;font-weight:bold">readdir</span>(<span style="color:#e06c75">DIR</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">dirp</span>);
</span></span></code></pre></div><p>æ¯æ¬¡å¯¹ <code>readdir</code> çš„è°ƒç”¨è¿”å›åˆ°éƒ½æ˜¯æŒ‡å‘æµ <code>drip</code> ä¸­ä¸‹ä¸€ä¸ªç›®å½•é¡¹çš„æŒ‡é’ˆï¼Œæ¯ä¸ªç›®å½•é¡¹éƒ½æ˜¯ä¸€ä¸ªç»“æ„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#c678dd">struct</span> <span style="color:#e06c75">dirent</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">ino_t</span> <span style="color:#e06c75">d_ino</span>;	<span style="color:#7f848e">// inode number
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>    <span style="color:#e5c07b">char</span> <span style="color:#e06c75">d_name</span>[<span style="color:#d19a66">256</span>];	<span style="color:#7f848e">// filename
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>}
</span></span></code></pre></div><blockquote>
<ol>
<li><strong>ä»€ä¹ˆæ˜¯ inodeï¼Ÿ</strong>
<ul>
<li>ç†è§£ inode éœ€è¦ä»æ–‡ä»¶å­˜å‚¨è¯´èµ·ã€‚</li>
<li>æ–‡ä»¶å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œç¡¬ç›˜çš„æœ€å°å­˜å‚¨å•ä½å«åšâ€œæ‰‡åŒºâ€ï¼ˆSectorï¼‰ã€‚</li>
<li>æ¯ä¸ªæ‰‡åŒºå‚¨å­˜512å­—èŠ‚ï¼ˆç›¸å½“äº0.5KBï¼‰ã€‚</li>
<li>æ“ä½œç³»ç»Ÿè¯»å–ç¡¬ç›˜æ—¶ï¼Œä¸ä¼šä¸€ä¸ªä¸ªæ‰‡åŒºåœ°è¯»å–ï¼Œè€Œæ˜¯ä¸€æ¬¡æ€§è¿ç»­è¯»å–å¤šä¸ªæ‰‡åŒºï¼Œå³ä¸€æ¬¡æ€§è¯»å–ä¸€ä¸ªâ€œå—â€ï¼ˆblockï¼‰ã€‚</li>
<li>è¿™ç§ç”±å¤šä¸ªæ‰‡åŒºç»„æˆçš„â€œå—â€æ˜¯æ–‡ä»¶å­˜å–çš„æœ€å°å•ä½ã€‚</li>
<li>â€œå—â€çš„å¤§å°é€šå¸¸æ˜¯4KBï¼Œå³è¿ç»­å…«ä¸ªæ‰‡åŒºç»„æˆä¸€ä¸ª blockã€‚</li>
<li>æ–‡ä»¶æ•°æ®å­˜å‚¨åœ¨â€œå—â€ä¸­ï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåœ°æ–¹æ¥å­˜å‚¨æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚æ–‡ä»¶çš„åˆ›å»ºè€…ã€åˆ›å»ºæ—¥æœŸã€å¤§å°ç­‰ç­‰ã€‚</li>
<li>è¿™ä¸ªå­˜å‚¨æ–‡ä»¶å…ƒä¿¡æ¯çš„åŒºåŸŸå°±å«åš <strong>inode</strong>ï¼Œä¸­æ–‡è¯‘åä¸ºâ€œç´¢å¼•èŠ‚ç‚¹â€ã€‚</li>
<li>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„ inodeï¼Œé‡Œé¢åŒ…å«äº†ä¸è¯¥æ–‡ä»¶æœ‰å…³çš„ä¸€äº›ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><strong>inode çš„å†…å®¹</strong>
<ul>
<li>inode åŒ…å«æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œå…·ä½“åŒ…æ‹¬ï¼š
<ul>
<li>æ–‡ä»¶çš„å­—èŠ‚æ•°</li>
<li>æ–‡ä»¶æ‹¥æœ‰è€…çš„ User ID</li>
<li>æ–‡ä»¶çš„ Group ID</li>
<li>æ–‡ä»¶çš„è¯»ã€å†™ã€æ‰§è¡Œæƒé™</li>
<li>æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼ˆctimeã€mtimeã€atimeï¼‰</li>
<li>é“¾æ¥æ•°ï¼ˆæœ‰å¤šå°‘æ–‡ä»¶åæŒ‡å‘è¿™ä¸ª inodeï¼‰</li>
<li>æ–‡ä»¶æ•°æ® block çš„ä½ç½®</li>
</ul>
</li>
<li>é™¤äº†æ–‡ä»¶åä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯éƒ½å­˜åœ¨ inode ä¸­ã€‚</li>
</ul>
</li>
<li><strong>inode çš„å¤§å°</strong>
<ul>
<li>inode ä¹Ÿä¼šæ¶ˆè€—ç¡¬ç›˜ç©ºé—´ï¼Œå› æ­¤ç¡¬ç›˜æ ¼å¼åŒ–æ—¶ä¼šè‡ªåŠ¨å°†ç¡¬ç›˜åˆ†æˆä¸¤ä¸ªåŒºåŸŸï¼šæ•°æ®åŒºå’Œ inode åŒºï¼ˆinode tableï¼‰ã€‚</li>
<li>æ¯ä¸ª inode èŠ‚ç‚¹çš„å¤§å°ä¸€èˆ¬æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚</li>
<li>inode èŠ‚ç‚¹çš„æ€»æ•°åœ¨æ ¼å¼åŒ–æ—¶ç»™å®šï¼Œé€šå¸¸æ˜¯æ¯1KBæˆ–æ¯2KBè®¾ç½®ä¸€ä¸ª inodeã€‚</li>
<li>å¦‚æœ inode èŠ‚ç‚¹ç”¨å°½ï¼Œä½†ç¡¬ç›˜æœªæ»¡ï¼Œå°±æ— æ³•åœ¨ç¡¬ç›˜ä¸Šåˆ›å»ºæ–°æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><strong>inode å·ç </strong>
<ul>
<li>æ¯ä¸ª inode éƒ½æœ‰ä¸€ä¸ªå·ç ï¼Œæ“ä½œç³»ç»Ÿç”¨ inode å·ç æ¥è¯†åˆ«ä¸åŒçš„æ–‡ä»¶ã€‚</li>
<li>Unix/Linux ç³»ç»Ÿå†…éƒ¨ä¸ä½¿ç”¨æ–‡ä»¶åï¼Œè€Œä½¿ç”¨ inode å·ç æ¥è¯†åˆ«æ–‡ä»¶ã€‚</li>
<li>æ–‡ä»¶ååªæ˜¯ inode å·ç ä¾¿äºè¯†åˆ«çš„åˆ«ç§°ã€‚</li>
<li>ä½¿ç”¨ <code>ls -i</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶åå¯¹åº”çš„ inode å·ç ã€‚</li>
</ul>
</li>
<li><strong>ç›®å½•æ–‡ä»¶</strong>
<ul>
<li>ç›®å½•ï¼ˆdirectoryï¼‰ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ï¼Œå®é™…ä¸Šå°±æ˜¯ç›®å½•æ–‡ä»¶ã€‚</li>
<li>ç›®å½•æ–‡ä»¶çš„ç»“æ„æ˜¯ä¸€ç³»åˆ—ç›®å½•é¡¹ï¼ˆdirentï¼‰çš„åˆ—è¡¨ï¼Œæ¯ä¸ªç›®å½•é¡¹åŒ…å«æ–‡ä»¶åå’Œå¯¹åº”çš„ inode å·ç ã€‚</li>
<li>ä½¿ç”¨ <code>ls -l</code> å‘½ä»¤å¯ä»¥åˆ—å‡ºæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><strong>ç¡¬é“¾æ¥</strong>
<ul>
<li>Unix/Linux ç³»ç»Ÿå…è®¸å¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ä¸ª inode å·ç ï¼Œè¿™ç§°ä¸ºâ€œç¡¬é“¾æ¥â€ï¼ˆhard linkï¼‰ã€‚</li>
<li>ç¡¬é“¾æ¥å¯ä»¥åˆ›å»ºç›¸åŒ inode å·ç çš„æ–‡ä»¶ï¼Œåˆ é™¤ä¸€ä¸ªæ–‡ä»¶åä¸å½±å“å…¶ä»–æ–‡ä»¶åçš„è®¿é—®ã€‚</li>
</ul>
</li>
<li><strong>è½¯é“¾æ¥</strong>
<ul>
<li>æ–‡ä»¶ A çš„å†…å®¹æ˜¯æ–‡ä»¶ B çš„è·¯å¾„ï¼Œè¿™ç§°ä¸ºâ€œè½¯é“¾æ¥â€ï¼ˆsoft linkï¼‰æˆ–â€œç¬¦å·é“¾æ¥â€ï¼ˆsymbolic linkï¼‰ã€‚</li>
<li>æ–‡ä»¶ A ä¾èµ–äºæ–‡ä»¶ B å­˜åœ¨ï¼Œåˆ é™¤æ–‡ä»¶ B ä¼šå¯¼è‡´æ‰“å¼€æ–‡ä»¶ A æŠ¥é”™ã€‚</li>
</ul>
</li>
</ol>
</blockquote>
<p>æˆ‘ä»¬é€šè¿‡ <code>closedir</code> å…³é—­æµå¹¶é‡Šæ”¾æ‰€æœ‰çš„èµ„æºã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;dirent.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">closedir</span>(<span style="color:#e06c75">DIR</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">dirp</span>);
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€çœ‹å®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">argc</span>, <span style="color:#e5c07b">char</span> <span style="color:#56b6c2">**</span><span style="color:#e06c75">argv</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">DIR</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">streamp</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">struct</span> <span style="color:#e06c75">dirent</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">dep</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">streamp</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">opendir</span>(<span style="color:#e06c75">argv</span>[<span style="color:#d19a66">1</span>]);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">errno</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">while</span> ((<span style="color:#e06c75">dep</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">readdir</span>(<span style="color:#e06c75">streamp</span>)) <span style="color:#56b6c2">!=</span> <span style="color:#e5c07b">NULL</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;Found file: %s </span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#e06c75">dep</span><span style="color:#56b6c2">-&gt;</span><span style="color:#e06c75">d_name</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#e06c75">errno</span> <span style="color:#56b6c2">!=</span> <span style="color:#d19a66">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#61afef;font-weight:bold">unix_error</span>(<span style="color:#98c379">&#34;readdir error&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">closedir</span>(<span style="color:#e06c75">streamp</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">eixt</span>(<span style="color:#d19a66">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å…±äº«æ–‡ä»¶">å…±äº«æ–‡ä»¶</h2>
<p>å†…æ ¸ç”¨ä¸‰ä¸ªç›¸å…³çš„æ•°æ®ç»“æ„æ¥è¡¨ç¤ºæ‰“å¼€çš„æ–‡ä»¶ï¼š</p>
<ul>
<li>æè¿°ç¬¦è¡¨ï¼ˆdescriptor tableï¼‰ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒç‹¬ç«‹çš„æè¿°è¡¨ï¼Œå®ƒçš„è¡¨é¡¹æ˜¯ç”±è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ¥ç´¢å¼•çš„ã€‚</li>
<li>æ–‡ä»¶è¡¨ï¼ˆfile tableï¼‰ã€‚æ‰“å¼€æ–‡ä»¶é›†åˆæ˜¯ç”±ä¸€å¼ æ–‡ä»¶è¡¨æ¥è¡¨ç¤ºçš„ï¼Œæ‰€æœ‰è¿›ç¨‹å…±äº«è¿™å¼ è¡¨ã€‚æ¯ä¸ªè¡¨é¡¹åŒ…æ‹¬ï¼š
<ul>
<li>å½“å‰çš„æ–‡ä»¶ä½ç½®ï¼šè¡¨ç¤ºä¸‹ä¸€æ¬¡è¯»æˆ–å†™çš„ä½ç½®ã€‚</li>
<li>å¼•ç”¨è®¡æ•°ï¼šè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªæè¿°ç¬¦æŒ‡å‘è¯¥æ–‡ä»¶è¡¨è¡¨é¡¹ã€‚</li>
<li>æŒ‡å‘ <code>v-node</code> è¡¨ä¸­å¯¹åº”è¡¨é¡¹çš„æŒ‡é’ˆã€‚</li>
</ul>
</li>
<li><code>v-node</code> è¡¨ï¼ˆv-node tableï¼‰ã€‚åŒæ–‡ä»¶è¡¨ä¸€æ ·ï¼Œæ‰€æœ‰çš„è¿›ç¨‹å…±äº«è¿™è´¦ <code>v-node</code> è¡¨ã€‚æ¯ä¸ª <code>v-node</code> è¡¨è¡¨é¡¹å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œè®°å½•æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚æƒé™ã€å¤§å°ã€ç±»å‹ç­‰ã€‚</li>
</ul>
<p><figure 
	>
	<a href="https://s2.loli.net/2024/03/28/PtZhlLA8py5aDYs.png" >
		<img src="https://s2.loli.net/2024/03/28/PtZhlLA8py5aDYs.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>å¤šä¸ªæè¿°ç¬¦ä¹Ÿå¯ä»¥é€šè¿‡ä¸åŒçš„æ–‡ä»¶è¡¨é¡¹æ¥å¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶ã€‚å½“ç”¨åŒä¸€ä¸ª filename è°ƒç”¨ open å‡½æ•°ä¸¤æ¬¡å°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚</p>
<p><figure 
	>
	<a href="https://s2.loli.net/2024/03/28/SvEkOV4nQ1RzGLg.png" >
		<img src="https://s2.loli.net/2024/03/28/SvEkOV4nQ1RzGLg.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>åœ¨è°ƒç”¨ fork ä¹‹åï¼Œå­è¿›ç¨‹ä¼šæœ‰çˆ¶è¿›ç¨‹çš„ä¸€ä¸ªæè¿°ç¬¦è¡¨çš„å‰¯æœ¬ã€‚çˆ¶å­è¿›ç¨‹å…±äº«ç›¸åŒçš„æ–‡ä»¶æ‰“å¼€é›†åˆï¼Œå› æ­¤å…±äº«ç›¸åŒçš„æ–‡ä»¶ä½ç½®ã€‚</p>
<p><figure 
	>
	<a href="https://s2.loli.net/2024/03/29/bY3d7Sml8yjergN.png" >
		<img src="https://s2.loli.net/2024/03/29/bY3d7Sml8yjergN.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<blockquote>
<p><strong>forkã€wait å’Œ waitpid</strong></p>
<p>fork()ï¼š</p>
<ul>
<li><code>fork()</code> å‡½æ•°ç”¨äºåˆ›å»ºæ–°è¿›ç¨‹ã€‚å½“çˆ¶è¿›ç¨‹è°ƒç”¨<code>fork()</code> æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ã€‚å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«ç›¸åŒçš„ä»£ç æ®µã€æ•°æ®æ®µã€å †æ ˆæ®µç­‰ã€‚</li>
<li>åœ¨å­è¿›ç¨‹ä¸­ï¼Œ<code>fork()</code> è¿”å›0ï¼›åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œè¿”å›å­è¿›ç¨‹çš„è¿›ç¨‹IDã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;stdio.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;stdlib.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;sys/types.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;unistd.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span> <span style="color:#e5c07b">pid_t</span> <span style="color:#e06c75">pid</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">fork</span>();
</span></span><span style="display:flex;"><span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">pid</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;æˆ‘æ˜¯å­è¿›ç¨‹ï¼Œè¿›ç¨‹IDï¼š%d</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#61afef;font-weight:bold">getpid</span>());
</span></span><span style="display:flex;"><span> } <span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">pid</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;æˆ‘æ˜¯çˆ¶è¿›ç¨‹ï¼Œè¿›ç¨‹IDï¼š%dï¼Œå­è¿›ç¨‹IDï¼š%d</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#61afef;font-weight:bold">getpid</span>(), <span style="color:#e06c75">pid</span>);
</span></span><span style="display:flex;"><span> } <span style="color:#c678dd">else</span> {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;forkå‡ºé”™ï¼</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>);
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> <span style="color:#c678dd">return</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>wait()ï¼š</p>
<ul>
<li><code>wait()</code> å‡½æ•°ç”¨äºç­‰å¾…å­è¿›ç¨‹ç»“æŸã€‚å½“å­è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œçˆ¶è¿›ç¨‹é€šè¿‡ <code>wait()</code> è·å–å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;stdio.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;stdlib.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;sys/types.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;sys/wait.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;unistd.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span> <span style="color:#e5c07b">pid_t</span> <span style="color:#e06c75">pid</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">fork</span>();
</span></span><span style="display:flex;"><span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">pid</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;æˆ‘æ˜¯å­è¿›ç¨‹ï¼Œè¿›ç¨‹IDï¼š%d</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#61afef;font-weight:bold">getpid</span>());
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">exit</span>(<span style="color:#d19a66">0</span>);
</span></span><span style="display:flex;"><span> } <span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">pid</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;æˆ‘æ˜¯çˆ¶è¿›ç¨‹ï¼Œè¿›ç¨‹IDï¼š%dï¼Œå­è¿›ç¨‹IDï¼š%d</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#61afef;font-weight:bold">getpid</span>(), <span style="color:#e06c75">pid</span>);
</span></span><span style="display:flex;"><span>     <span style="color:#e5c07b">int</span> <span style="color:#e06c75">status</span>;
</span></span><span style="display:flex;"><span>     <span style="color:#e5c07b">pid_t</span> <span style="color:#e06c75">wpid</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">wait</span>(<span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">status</span>);
</span></span><span style="display:flex;"><span>     <span style="color:#c678dd">if</span> (<span style="color:#e06c75">wpid</span> <span style="color:#56b6c2">==</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>) {
</span></span><span style="display:flex;"><span>         <span style="color:#61afef;font-weight:bold">perror</span>(<span style="color:#98c379">&#34;waitå‡ºé”™&#34;</span>);
</span></span><span style="display:flex;"><span>         <span style="color:#61afef;font-weight:bold">exit</span>(<span style="color:#d19a66">1</span>);
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>     <span style="color:#c678dd">if</span> (<span style="color:#61afef;font-weight:bold">WIFEXITED</span>(<span style="color:#e06c75">status</span>)) {
</span></span><span style="display:flex;"><span>         <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;å­è¿›ç¨‹ä»¥çŠ¶æ€ %d é€€å‡º</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#61afef;font-weight:bold">WEXITSTATUS</span>(<span style="color:#e06c75">status</span>));
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span> } <span style="color:#c678dd">else</span> {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;forkå‡ºé”™ï¼</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>);
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> <span style="color:#c678dd">return</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>waitpid()ï¼š</p>
<ul>
<li><code>waitpid()</code>å‡½æ•°ç±»ä¼¼äº<code>wait()</code>ï¼Œä½†æä¾›æ›´çµæ´»çš„ç­‰å¾…æ–¹å¼ã€‚æ‚¨å¯ä»¥æŒ‡å®šç­‰å¾…ç‰¹å®šçš„å­è¿›ç¨‹ï¼Œä»¥åŠæ§åˆ¶ç­‰å¾…çš„è¡Œä¸ºã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;stdio.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;sys/wait.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e">#include</span> <span style="color:#7f848e">&lt;unistd.h&gt;</span><span style="color:#7f848e">
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span> <span style="color:#e5c07b">int</span> <span style="color:#e06c75">status</span>;
</span></span><span style="display:flex;"><span> <span style="color:#e5c07b">pid_t</span> <span style="color:#e06c75">pid</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">fork</span>();
</span></span><span style="display:flex;"><span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">pid</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;forkå‡ºé”™</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>);
</span></span><span style="display:flex;"><span> } <span style="color:#c678dd">else</span> <span style="color:#c678dd">if</span> (<span style="color:#e06c75">pid</span> <span style="color:#56b6c2">==</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;è¿™æ˜¯å­è¿›ç¨‹ï¼Œè¿›ç¨‹IDï¼š%d</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#61afef;font-weight:bold">getpid</span>());
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">sleep</span>(<span style="color:#d19a66">1</span>);
</span></span><span style="display:flex;"><span>     <span style="color:#c678dd">return</span> <span style="color:#d19a66">1</span>;
</span></span><span style="display:flex;"><span> } <span style="color:#c678dd">else</span> {
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;è¿™æ˜¯çˆ¶è¿›ç¨‹ï¼Œè¿›ç¨‹IDï¼š%d</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#61afef;font-weight:bold">getpid</span>());
</span></span><span style="display:flex;"><span>     <span style="color:#e5c07b">pid_t</span> <span style="color:#e06c75">wait_pid</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">waitpid</span>(<span style="color:#e06c75">pid</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">status</span>, <span style="color:#d19a66">0</span>);
</span></span><span style="display:flex;"><span>     <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;å­è¿›ç¨‹ %d ä»¥çŠ¶æ€ %d é€€å‡º</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#e06c75">wait_pid</span>, <span style="color:#61afef;font-weight:bold">WEXITSTATUS</span>(<span style="color:#e06c75">status</span>));
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> <span style="color:#c678dd">return</span> <span style="color:#d19a66">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></blockquote>
<h2 id="io-é‡å®šå‘">I/O é‡å®šå‘</h2>
<p>Linux shell æä¾›çš„é‡å®šå‘å°±æ˜¯ï¼Œå…è®¸ç”¨æˆ·å°†ç£ç›˜æ–‡ä»¶å’Œæ ‡å‡†è¾“å…¥è¾“å‡ºè”ç³»èµ·æ¥ã€‚</p>
<p>å½“ Web æœåŠ¡å™¨ä»£è¡¨å®¢æˆ·è¿è¡Œ CGI ç¨‹åºçš„æ—¶å€™ï¼Œå®ƒå°±æ‰§è¡Œä¸€ç§ç›¸ä¼¼ç±»å‹çš„é‡å®šå‘ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;unistd&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">dup2</span>(<span style="color:#e5c07b">int</span> <span style="color:#e06c75">oldfd</span>, <span style="color:#e5c07b">int</span> <span style="color:#e06c75">newfd</span>);
</span></span></code></pre></div><p><code>dup2</code> å‡½æ•°å¤åˆ¶ <code>oldfd</code> æ–‡ä»¶å†…å®¹åˆ° <code>newfd</code> æ–‡ä»¶ï¼Œè¦†ç›– <code>newfd</code>ã€‚å¦‚æœ <code>newfd</code> æ˜¯æ‰“å¼€äº†ï¼Œåˆ™ä¼šåœ¨å¤åˆ¶ä¹‹å‰è¢«å…³é—­ã€‚é‚£ä¹ˆå®é™…ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å¯¹ <code>newfd</code> çš„å†…å®¹è¿›è¡Œè¦†ç›–ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æè¿°ç¬¦æŒ‡å‘ <code>oldfd</code> å°±å¯ä»¥äº†ã€‚</p>
<p>é€šè¿‡è°ƒç”¨ <code>dup2(4,1)</code> é‡å®šå‘åï¼Œæ–‡ä»¶Aè¢«å…³é—­ï¼ŒåŸæœ¬çš„æè¿°ç¬¦ä¼šæŒ‡å‘æ–‡ä»¶ Bã€‚</p>
<p><figure 
	>
	<a href="https://s2.loli.net/2024/03/29/VUxzqHFlmy4uoiR.png" >
		<img src="https://s2.loli.net/2024/03/29/VUxzqHFlmy4uoiR.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;stdio.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;unistd.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e5c07b">int</span> <span style="color:#61afef;font-weight:bold">main</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">int</span> <span style="color:#e06c75">fd1</span>, <span style="color:#e06c75">fd2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e5c07b">char</span> <span style="color:#e06c75">c</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">fd1</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">open</span>(<span style="color:#98c379">&#34;foo.txt&#34;</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">c</span>, <span style="color:#d19a66">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">fd2</span> <span style="color:#56b6c2">=</span> <span style="color:#61afef;font-weight:bold">open</span>(<span style="color:#98c379">&#34;foo.txt&#34;</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">c</span>, <span style="color:#d19a66">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">read</span>(<span style="color:#e06c75">fd2</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">c</span>, <span style="color:#d19a66">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">dup2</span>(<span style="color:#e06c75">fd2</span>, <span style="color:#e06c75">fd1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">read</span>(<span style="color:#e06c75">fd1</span>, <span style="color:#56b6c2">&amp;</span><span style="color:#e06c75">c</span>, <span style="color:#d19a66">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;c = %c </span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#e06c75">c</span>); 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ ‡å‡† I/O</p>
<p>æ ‡å‡† I/O åº“å°†ä¸€ä¸ªæ‰“å¼€éƒ½æ–‡ä»¶æ¨¡å‹åŒ–ä¸º æµã€‚ä¸€ä¸ªæµå°±æ˜¯ä¸€ä¸ªæŒ‡å‘ FILE ç±»å‹çš„ç»“æ„çš„æŒ‡é’ˆã€‚</p>
<p>æ¯ä¸ª ANSI C ç¨‹åºå¼€å§‹éƒ½æœ‰ä¸‰ä¸ªæ‰“å¼€çš„æµ stdinã€stdout å’Œ stderrã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#7f848e"># include &lt;stdio.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#c678dd">extern</span> <span style="color:#e06c75">FILE</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">stdin</span>;		<span style="color:#7f848e">// 0
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#c678dd">extern</span> <span style="color:#e06c75">FILE</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">stdout</span>;	<span style="color:#7f848e">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#c678dd">extern</span> <span style="color:#e06c75">FILE</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">stderr</span>;	<span style="color:#7f848e">// 2
</span></span></span></code></pre></div><p>ç±»å‹ä¸º FILE çš„æµæ˜¯å¯¹æ–‡ä»¶æè¿°ç¬¦å’Œæµç¼“å†²åŒºçš„æŠ½è±¡ã€‚</p>
<p>æµç¼“å†²åŒºçš„ç›®çš„å’Œ RIO è¯»ç¼“å†²åŒºçš„ä¸€æ ·ï¼šå°±æ˜¯è®©å¼€é”€é«˜çš„ Linux I/O ç³»ç»Ÿè°ƒç”¨çš„æ•°é‡å°½å¯èƒ½å°ã€‚</p>
<h2 id="io-å‡½æ•°ç»¼åˆ">I/O å‡½æ•°ç»¼åˆ</h2>
<p><figure 
	>
	<a href="https://s2.loli.net/2024/03/29/V51JOYLl4IMHAaS.png" >
		<img src="https://s2.loli.net/2024/03/29/V51JOYLl4IMHAaS.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>ä»¥ä¸‹ä¸ºä½¿ç”¨è§„åˆ™ï¼š</p>
<ul>
<li>åªè¦æœ‰å¯èƒ½å°±å°½é‡ç”¨æ ‡å‡† I/Oã€‚</li>
<li>ä¸è¦ç”¨ scanf æˆ– rio_readlineb æ¥è¯»äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
<li>å¯¹ç½‘ç»œå¥—æ¥å­—çš„ I/O ä½¿ç”¨ RIO å‡½æ•°ã€‚</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/linux/">Linux</a>
        
            <a href="/tags/c/">C</a>
        
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">è®¡ç®—æœºç½‘ç»œ</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/2024/linux-c%E4%B8%80%E5%85%A5%E9%97%A8/">
        
        
            <div class="article-image">
                <img src="/2024/linux-c%E4%B8%80%E5%85%A5%E9%97%A8/cover.b1f0c75a8eec7bb44f8009dc314a1621_huc77e13b628f6c253544f486e9b91b9b1_1927448_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Linux Cï¼ˆä¸€ï¼‰å…¥é—¨"
                        data-key="Linux Cï¼ˆä¸€ï¼‰å…¥é—¨" 
                        data-hash="md5-sfDHWo7se7RPgAncMUoWIQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Linux Cï¼ˆä¸€ï¼‰å…¥é—¨</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/2024/%E7%AE%80%E6%98%8E%E7%9A%84go%E5%AD%A6%E4%B9%A0/">
        
        
            <div class="article-image">
                <img src="/2024/%E7%AE%80%E6%98%8E%E7%9A%84go%E5%AD%A6%E4%B9%A0/cover.67bb3671f19af1e9664a10e971934279_hu6c64888fb7dba8ea3f9b3ae918b049b3_2340567_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post ç®€æ˜çš„GOå­¦ä¹ "
                        data-key="ç®€æ˜çš„GOå­¦ä¹ " 
                        data-hash="md5-Z7s2cfGa8elmShDpcZNCeQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ç®€æ˜çš„GOå­¦ä¹ </h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/2024/shell%E5%AD%A6%E4%B9%A0/">
        
        
            <div class="article-image">
                <img src="/2024/shell%E5%AD%A6%E4%B9%A0/cover.51251896a6af909388445aa0d04e4754_hu87cba6621d1cba6cf29db5a9878ced61_565035_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Shellå­¦ä¹ "
                        data-key="Shellå­¦ä¹ " 
                        data-hash="md5-USUYlqavkJOIRFqg0E5HVA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Shellå­¦ä¹ </h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
    .waline-container .vcount {
        color: var(--card-text-color-main);
    }
</style><script>
    
    new Waline({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili","https://npm.elemecdn.com/@waline/emojis@1.1.0/bmoji","https://npm.elemecdn.com/@waline/emojis@1.1.0/weibo"],"lang":"zh-CN","locale":{"admin":"ç«™é•¿","sofa":"è¿˜æ²¡æœ‰äººè¯„è®ºå“¦ï¼å¿«æ¥æŠ¢æ²™å‘å§~"},"placeholder":"æ¬¢è¿ç•™è¨€ï¼","requiredMeta":["name","email","url"],"serverURL":"https://vercel-db-yikuanzzs-projects.vercel.app/"});
</script>

    

    <footer class="site-footer">
  


    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


<script>
(function(u, c) {
  var d = document, t = 'script', o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
  o.src = u;
  if (c) { o.addEventListener('load', function(e) { c(e); }); }
  s.parentNode.insertBefore(o, s);
})('//cdn.bootcss.com/pangu/3.3.0/pangu.min.js', function() {
  pangu.spacingPage();
});
</script>

    <section class="copyright">
        &copy; 
        
        2024 <a href="https://yikuanzz.github.io//">Yikuanzz</a>Â·<i class="fas fa-bell"></i> <a id="days">0</a>Days<br>
      å…±ä¹¦å†™äº†140.3kå­—Â·å…± 23ç¯‡æ–‡ç« </br><span><p>
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a><br />
         <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">Â© Licensed Under CC BY-NC-SA 4.0</a>
    </section>

<script>
var s1 = '2024-03-22';
s1 = new Date(s1.replace(/-/g, "/"));
s2 = new Date();
var days = s2.getTime() - s1.getTime();
var number_of_days = parseInt(days / (1000 * 60 * 60 * 24));
document.getElementById('days').innerHTML = number_of_days;
</script>
    
</footer>



    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
    
    
    <aside class="sidebar right-sidebar sticky">
        
            <form action="/search/" class="search-form widget" >
        <p>
            <label>Search</label>
            <input name="keyword" required placeholder="Type something..." />
        
            <button title="Search">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
        
            
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#unix-io">Unix I/O</a></li>
    <li><a href="#æ–‡ä»¶">æ–‡ä»¶</a></li>
    <li><a href="#æ‰“å¼€å’Œå…³é—­æ–‡ä»¶">æ‰“å¼€å’Œå…³é—­æ–‡ä»¶</a></li>
    <li><a href="#è¯»å’Œå†™æ–‡ä»¶">è¯»å’Œå†™æ–‡ä»¶</a></li>
    <li><a href="#rio-å¥å£®åœ°è¯»å†™">RIO å¥å£®åœ°è¯»å†™</a></li>
    <li><a href="#è¯»å–æ–‡ä»¶å…ƒæ•°æ®">è¯»å–æ–‡ä»¶å…ƒæ•°æ®</a></li>
    <li><a href="#è¯»å–ç›®å½•å†…å®¹">è¯»å–ç›®å½•å†…å®¹</a></li>
    <li><a href="#å…±äº«æ–‡ä»¶">å…±äº«æ–‡ä»¶</a></li>
    <li><a href="#io-é‡å®šå‘">I/O é‡å®šå‘</a></li>
    <li><a href="#io-å‡½æ•°ç»¼åˆ">I/O å‡½æ•°ç»¼åˆ</a></li>
  </ol>
</nav>
        </div>
    </section>

        
            <section class="widget categories">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>


  
        </div> 
        <h2 class="widget-title section-title">Categories</h2>
    <div class="widget-categories--list">
<div class="widget">
    <h3 class="widget-title"> </h3>
    <div class="widget-body">
        <div class="category-list">
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="category-list-link">äººå·¥æ™ºèƒ½<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E5%BC%80%E5%8F%91%E8%BF%90%E7%BB%B4%E6%8A%80%E6%9C%AF/" class="category-list-link">å¼€å‘è¿ç»´æŠ€æœ¯<span class="category-list-count">6</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E6%8A%80%E6%9C%AF%E4%B8%8E%E6%95%88%E7%8E%87/" class="category-list-link">æŠ€æœ¯ä¸æ•ˆç‡<span class="category-list-count">9</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E6%95%B0%E5%AD%A6%E4%B8%8E%E7%89%A9%E7%90%86/" class="category-list-link">æ•°å­¦ä¸ç‰©ç†<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="category-list-link">æ•°æ®åº“<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="category-list-link">ç®—æ³•ä¸æ•°æ®ç»“æ„<span class="category-list-count">2</a>
            </span></div>
            <div class="category-list-item"><a href="https://yikuanzz.github.io/categories/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" class="category-list-link">è¯­è¨€å­¦ä¹ <span class="category-list-count">3</a>
            </span></div>
        </div>
    </div>
</div>
    </div>
    </section>
        
            <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>



        </div>
        <h2 class="widget-title section-title">Archives</h2>

        
        
        
        
        
        <div class="widget-archive--list">
            <div class="archives-year">
                    <a href="/archives/#2024">
                        
                            <span class="year">2024</span>
                            <span class="count">23</span>
                        
                    </a> 
                </div>
            
        </div>
    </section>
        
            <section class="widget tagCloud">
    <div class="widget-icon">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



    </div>
    <h2 class="widget-title section-title">Tags</h2>

    <div class="tagCloud-tags">
        
            <a href="/tags/note/" class="font_size_8">
                Note
            </a>
        
            <a href="/tags/web/" class="font_size_3">
                Web
            </a>
        
            <a href="/tags/%E8%8B%B1%E8%AF%AD/" class="font_size_3">
                è‹±è¯­
            </a>
        
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="font_size_3">
                è®¡ç®—æœºç½‘ç»œ
            </a>
        
            <a href="/tags/c/" class="font_size_2">
                C
            </a>
        
            <a href="/tags/linux/" class="font_size_2">
                Linux
            </a>
        
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" class="font_size_2">
                è®¡ç®—æœºç»„æˆåŸç†
            </a>
        
            <a href="/tags/mysql/" class="font_size_1">
                MySQL
            </a>
        
            <a href="/tags/python/" class="font_size_1">
                Python
            </a>
        
            <a href="/tags/shell/" class="font_size_1">
                Shell
            </a>
        
    </div>
</section>
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
